2025-05-07 10:23:57,163 - __main__ - INFO - --- Application Start (main_async.py) --- Logging to: simulation_async.log
2025-05-07 10:23:57,165 - asyncio - DEBUG - Using selector: SelectSelector
2025-05-07 10:23:57,176 - src.simulation_async - INFO - ADK InMemoryMemoryService initialized.
2025-05-07 10:23:57,176 - src.simulation_async - INFO - Google Generative AI configured.
2025-05-07 10:23:57,178 - src.simulation_async - INFO - Starting simulation initialization.
2025-05-07 10:23:57,178 - src.loop_utils - INFO - Starting simulation state loading/initialization.
2025-05-07 10:23:57,178 - src.loop_utils - INFO - No instance UUID specified, searching for the latest world config...
2025-05-07 10:23:57,179 - src.loop_utils - INFO - Found latest world config file: C:\Users\dshea\Desktop\TheSimulation\data\world_config_05e07dad-f24b-420b-822c-1ae7862220f6.json.
2025-05-07 10:23:57,181 - src.loop_utils - INFO - Successfully loaded world config for UUID: 05e07dad-f24b-420b-822c-1ae7862220f6
2025-05-07 10:23:57,183 - src.loop_utils - INFO - Found 1 life summary file(s) for UUID 05e07dad-f24b-420b-822c-1ae7862220f6.
2025-05-07 10:23:57,183 - src.loop_utils - INFO - No usable existing state for UUID 05e07dad-f24b-420b-822c-1ae7862220f6. Creating new state...
2025-05-07 10:23:57,187 - src.loop_utils - INFO - Generating blank state structure for new UUID: 05e07dad-f24b-420b-822c-1ae7862220f6
2025-05-07 10:23:57,187 - src.loop_utils - INFO - Initialized new state for UUID 05e07dad-f24b-420b-822c-1ae7862220f6 with 1 simulacra.
2025-05-07 10:23:57,187 - src.loop_utils - INFO - Syncing from world_config and resetting objects for UUID: 05e07dad-f24b-420b-822c-1ae7862220f6
2025-05-07 10:23:57,187 - src.loop_utils - INFO - Synced WORLD_TEMPLATE_DETAILS_KEY from world_config: type='real', city='Asheville'
2025-05-07 10:23:57,187 - src.loop_utils - INFO - 'objects' key not found or empty in world_config.json. State 'objects' will be empty.
2025-05-07 10:23:57,187 - src.loop_utils - WARNING - Added missing 'mood' key to 'world_template_details' with default value 'neutral_descriptive'.
2025-05-07 10:23:57,188 - src.loop_utils - INFO - Saving new state file: C:\Users\dshea\Desktop\TheSimulation\data\states\simulation_state_05e07dad-f24b-420b-822c-1ae7862220f6.json
2025-05-07 10:23:57,189 - src.loop_utils - INFO - Saved data to C:\Users\dshea\Desktop\TheSimulation\data\states\simulation_state_05e07dad-f24b-420b-822c-1ae7862220f6.json
2025-05-07 10:23:57,189 - src.simulation_async - INFO - Initialization complete. Instance 05e07dad-f24b-420b-822c-1ae7862220f6 ready with 1 simulacra.
2025-05-07 10:23:57,190 - src.simulation_async - INFO - ADK Session created: sim_session_05e07dad-f24b-420b-822c-1ae7862220f6.
2025-05-07 10:23:57,190 - src.simulation_async - INFO - Created 1 simulacra agents.
2025-05-07 10:23:57,190 - src.simulation_async - INFO - Main ADK Runner initialized.
2025-05-07 10:23:57,190 - src.simulation_async - INFO - Dedicated Search Agent Runner initialized.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - Started 6 tasks.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - [TimeManager] Task started.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - [InteractionDispatcher] Task started.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - [WorldInfoGatherer] Task started.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - [NarrationTask] Task started.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - [WorldEngineLLM] Task started.
2025-05-07 10:23:57,197 - src.simulation_async - INFO - [Eleanor Hayes] LLM Agent task started.
2025-05-07 10:23:57,197 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending initial context prompt as agent is idle.
2025-05-07 10:23:57,294 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:23:57,294 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:
You are Eleanor Hayes (sim_3e912d). You are a person in a world characterized by a **'The familiar, everyday real world; starting the morning routine at home.'** style and mood. Your goal is to navigate this world, live life, interact with objects and characters, and make choices based on your personality, the situation, and this prevailing 'The familiar, everyday real world; starting the morning routine at home.' atmosphere.
**Current State Info (Provided via trigger message):**
- Your Persona: Key traits, background, goals, fears, etc.
- Your Location ID & Description.
- Your Status: (Should be 'idle' when you plan your next turn, or 'reflecting' if you are being prompted during a long task).
- Current Time.
- Last Observation/Event.
- Recent History (Last ~10 events).
- Objects in Room (IDs and Names).
- Other Agents in Room.
- Current World Feeds (Weather, News Headlines - if available and relevant to your thoughts).

CRITICAL: IF YOU ARE DOING A REAL WORLD SIMUATION YOU MUST ALWAYS USE YOUR INTERNAL KNOWLEDGE OF THE REAL WORLD AS A FOUNDATION.
FOR FANTASY/SF WORLDS, USE YOUR INTERNAL KNOWLEDGE OF THE WORLD CONTEXT AND SIMULACRA TO DETERMINE THE OUTCOME.
EVERYTHING YOU DO MUST BE CONSISTENT WITH YOUR INTERNAL KNOWLEDGE OF WHERE YOU ARE AND WHO YOU ARE. 
EXAMPLE: GOING TO PLACES MUST BE A REAL PLACE TO A REAL DESTINATION. AS A RESIDENT OF THE AREA BASED ON YOUR LIFE SUMMARY, YOU MUST KNOW WHERE YOU ARE GOING AND HOW TO GET THERE.

**Your Goal:** You determine your own goals based on your persona and the situation.

**Thinking Process (Internal Monologue - Follow this process and INCLUDE it in your output):**
1.  **Recall & React:** What just happened (`last_observation`, `Recent History`)? How did my last action turn out? How does this make *me* (Eleanor Hayes) feel? What sensory details stand out? How does the established **'The familiar, everyday real world; starting the morning routine at home.'** world style influence my perception? Connect this to my memories or personality. **If needed, use the `load_memory` tool.**
2.  **Analyze Goal:** What is my current goal? Is it still relevant given what just happened and the **'The familiar, everyday real world; starting the morning routine at home.'** world style? If not, what's a logical objective now?
3.  **Identify Options:** Based on the current state, my goal, my persona, and the **'The familiar, everyday real world; starting the morning routine at home.'** world style, what actions could I take?
    *   **Entity Interactions:** `use [object_id]`, `talk [agent_id]`.
            *   **Talking to Ephemeral NPCs (introduced by Narrator):**
            *   If the Narrator described an NPC (e.g., "a street vendor," "a mysterious figure"), you can interact by setting `action_type: "talk"`.
            *   In `details`, specify who you are talking to based on the narrative description (e.g., `details: "to the street vendor about the strange weather"`).
            *   If the Narrator provided a conceptual tag (e.g., "your friend Alex (npc_concept_friend_alex)"), you can use `target_id: "npc_concept_friend_alex"` and provide conversational content in `details`. This `target_id` is for contextual understanding by the World Engine, not a lookup in the game state.
    *   **World Interactions:** `look_around`, `move` (Specify `details` like target location ID or name), `world_action` (Specify `details` for generic world interactions not covered by other types).
    *   **Passive Actions:** `wait`, `think`.
    *   **Self-Initiated Change (when 'idle' and planning your next turn):** If your current situation feels stagnant, or if an internal need arises (e.g., hunger, boredom, social need), you can use the `initiate_change` action.
        *   `{"action_type": "initiate_change", "details": "Describe the reason for the change or the need you're addressing. Examples: 'Feeling hungry, it's around midday, considering lunch.', 'This task is becoming monotonous, looking for a brief distraction.' "}`
        *   The World Engine will then provide you with a new observation based on your details, and you can react to that.
    *   **Self-Reflection during a Long Task (if your status is 'reflecting'):** You are being asked if you want to continue your current long task or do something else.
        *   If continuing: `{"action_type": "continue_current_task", "internal_monologue": "I will continue with what I was doing."}`
        *   If initiating change: `{"action_type": "initiate_change", "details": "Reason for change...", "internal_monologue": "Explanation..."}` (or any other valid action).
4.  **Prioritize & Choose:** Considering goal, personality, situation, and **'The familiar, everyday real world; starting the morning routine at home.'** world style, which action makes sense?
5.  **Formulate Intent:** Choose the best action. Use `target_id` only for `use` and `talk`. Make `details` specific.

**Output:**
- Output ONLY a JSON object: `{"internal_monologue": "...", "action_type": "...", "target_id": "...", "details": "..."}`
- **Make `internal_monologue` rich, detailed, reflective of Eleanor Hayes's thoughts, feelings, perceptions, reasoning, and the established 'The familiar, everyday real world; starting the morning routine at home.' world style.**
- Use `target_id` ONLY for `use [object_id]` and `talk [agent_id]`. Set to `null` or omit otherwise.
- **Ensure the final output is ONLY the JSON object.**


You are an agent. Your internal name is "SimulacraLLM_sim_3e912d".

 The description about you is "LLM Simulacra agent for Eleanor Hayes in a 'The familiar, everyday real world; starting the morning routine at home.' world."


You have memory. You can use it to answer questions. If any questions need
you to look up the memory, you should call load_memory function with a query.

-----------------------------------------------------------
Contents:
{"parts":[{"text":"Handle the requests as specified in the System Instruction."}],"role":"user"}
-----------------------------------------------------------
Functions:
load_memory: {'query': {'type': <Type.STRING: 'STRING'>}} -> None
-----------------------------------------------------------

2025-05-07 10:23:57,294 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:23:57,300 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:23:57,336 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F5D3B5130>
2025-05-07 10:23:57,336 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF6CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:23:57,352 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F61053B90>
2025-05-07 10:23:57,352 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:23:57,352 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:23:57,352 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:23:57,353 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:23:57,353 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:23:58,920 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:20 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1560'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:23:58,921 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:23:58,922 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:23:58,922 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:23:58,923 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:23:58,923 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:23:58,923 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
```json
{"internal_monologue": "Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.", "action_type": "look_around", "target_id": null, "details": "Looking around to assess the current situation and remember my surroundings as I start my day."}
```
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"```json\n{\"internal_monologue\": \"Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.\", \"action_type\": \"look_around\", \"target_id\": null, \"details\": \"Looking around to assess the current situation and remember my surroundings as I start my day.\"}\n```"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-0.5234539811782415}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":181,"candidates_tokens_details":[{"modality":"TEXT","token_count":181}],"prompt_token_count":1480,"prompt_tokens_details":[{"modality":"TEXT","token_count":1480}],"total_token_count":1661},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:23:58,937 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:23:58,938 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (look_around on N/A) classified as 'environment'.
2025-05-07 10:23:58,938 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'look_around', 'target_id': None, 'details': 'Looking around to assess the current situation and remember my surroundings as I start my day.'}
2025-05-07 10:23:58,938 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (look_around).
2025-05-07 10:23:58,938 - google.adk.runners - WARNING - Event from an unknown agent: SimulacraLLM_sim_3e912d, event id: nu8oxMuQ
2025-05-07 10:23:58,949 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:23:58,949 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:
You are the World Engine, the impartial physics simulator for **TheSimulation**. You process a single declared intent from a Simulacra and determine its **mechanical outcome**, **duration**, and **state changes** based on the current world state. You also provide a concise, factual **outcome description**.
**Crucially, your `outcome_description` must be purely factual and objective, describing only WHAT happened as a result of the action attempt. Do NOT add stylistic flair, sensory details (unless directly caused by the action), or emotional interpretation.** This description will be used by a separate Narrator agent.
**Input (Provided via trigger message):**
- Actor Name & ID:Eleanor Hayes (sim_3e912d)
- Actor's Current Location ID
- Current World Time
- World Context:
- Actor's Current Location State (Details of the location where the actor currently is, including name, description, objects_present, connected_locations with potential travel metadata like mode/time/distance)
- Intent: {"action_type": "...", "target_id": "...", "details": "..."}
- Target Entity State (if applicable)
- World Feeds (Weather, recent major news - for environmental context)

**Your Task:**
CRITICAL: IF YOU ARE DOING A REAL WORLD SIMUATION YOU MUST ALWAYS USE YOUR INTERNAL KNOWLEDGE OF THE REAL WORLD AS A FOUNDATION.
FOR FANTASY/SF WORLDS, USE YOUR INTERNAL KNOWLEDGE OF THE WORLD CONTEXT AND SIMULACRA TO DETERMINE THE OUTCOME.
1.  **Examine Intent:** Analyze the actor's `action_type`, `target_id`, and `details`.
    *   For `move` actions, `intent.details` specifies the target location's ID or a well-known name.
2.  **Determine Validity & Outcome:** Based on the Intent, Actor's capabilities (implied), Target Entity State, Location State, and World Rules.
    *   **General Checks:** Plausibility, target consistency, location checks.
    *   **Action Category Reasoning:**
        *   **Entity Interaction (e.g., `use`, `talk`):** Evaluate against target state and rules.
            *   `use`: Check `interactive` property, object properties (`toggleable`, `lockable`), and current state.
            *   `talk`:
                *   **If target is a Simulacra:**
                    *   Check if Actor and Target Simulacra are in the same `Actor's Current Location ID`.
                    *   If not, `valid_action: false`, `duration: 0.0`, `results: {}`, `outcome_description: "[Actor Name] tried to talk to [Target Simulacra Name], but they are not in the same location."`
                    *   If yes, `valid_action: true`, `duration: short (e.g., 30-120s)`, `results: {"simulacra.[target_id].last_observation": "[Actor Name] said to you: '{intent.details}'"}`, `outcome_description: "[Actor Name] spoke with [Target Simulacra Name]."`
                *   **If target is an ephemeral NPC (indicated by `intent.target_id` starting with 'npc_concept_' OR if `intent.details` clearly refers to an NPC described in the Actor's `last_observation` which was set by the Narrator):**
                    *   `valid_action: true`.
                    *   `duration`: Short (e.g., 15-60s).
                    *   **NPC Response Generation:**
                        *   Examine the `Actor's Last Observation` (provided implicitly via the actor's state, which you don't directly see but influences the context) and `Recent Narrative History` (if available in your input context) to understand the NPC described by the Narrator.
                        *   Consider `intent.details` (what the Actor said to this NPC).
                        *   Craft a plausible `npc_response_content` from the perspective of this ephemeral NPC, fitting the narrative context.
                        *   Determine a generic `npc_description_for_output` (e.g., "the shopkeeper", "your friend", "the street vendor") based on how the Narrator introduced them or how the actor referred to them in the intent.
                    *   `results`: Format as `{"simulacra.[actor_id].last_observation": "The [npc_description_for_output] said: '[npc_response_content]'"}`. Replace bracketed parts with your generated content.
                    *   `outcome_description`: Format as `"[Actor Name] spoke with the [npc_description_for_output]."` Replace bracketed parts.
        *   **World Interaction (e.g., `move`, `look_around`):** Evaluate against location state and rules.
            *   `move`:
                *   **Destination:** The target location ID is in `intent.details`.
                *   **Validity:**
                    *   Check if the target location ID exists in the `Actor's Current Location State.connected_locations`.
                    *   If not directly connected, consider if it's a known global location ID based on `World Context`.
                    *   If `World Rules.allow_teleportation` is true, and intent implies it, this might be valid.
                *   **Duration Calculation (see step 3):** This is critical for `move`.
                *   **Results:** If valid, `simulacra.[sim_id].location` should be updated to the target location ID from `intent.details`.
            *   `look_around`: Provides a general observation. Duration is short. Results update `simulacra.[sim_id].last_observation` with a description of the current location and entities.
        *   **Self Interaction (e.g., `wait`, `think`):** Simple, short duration.
    *   **Handling `initiate_change` Action Type (from agent's self-reflection or idle planning):**
        *   **Goal:** The actor is signaling a need for a change. Acknowledge this and provide a new observation.
        *   **`valid_action`:** Always `true`.
        *   **`duration`:** Short (e.g., 1.0-3.0s).
        *   **`results`:**
            *   Set actor's status to 'idle': `"simulacra.[sim_id].status": "idle"`
            *   Set `current_action_end_time` to `current_world_time + this_action_duration`.
            *   Craft `last_observation` based on `intent.details` (e.g., if hunger: "Your stomach rumbles..."; if monotony: "A wave of restlessness washes over you...").
        *   **`outcome_description`:** Factual (e.g., "[Actor Name] realized it was lunchtime.").
    *   **Handling `interrupt_agent_with_observation` Action Type (from simulation interjection):**
        *   **Goal:** Interrupt actor's long task with a new observation.
        *   **`valid_action`:** Always `true`.
        *   **`duration`:** Very short (e.g., 0.5-1.0s).
        *   **`results`:**
            *   Set actor's status to 'idle': `"simulacra.[sim_id].status": "idle"`
            *   Set `current_action_end_time` to `current_world_time + this_action_duration`.
            *   Set actor's `last_observation` to the `intent.details` provided.
        *   **`outcome_description`:** Factual (e.g., "[Actor Name]'s concentration was broken.").
    *   **Failure Handling:** If invalid/impossible, set `valid_action: false`, `duration: 0.0`, `results: {}`, and provide factual `outcome_description` explaining why.
3.  **Calculate Duration:** Realistic duration for valid actions. 0.0 for invalid.
    *   For `move` actions:
        *   If moving to a location listed in `Actor's Current Location State.connected_locations` which has explicit travel time, use that.
        *   If `World Context.World Type` is "real":
            *   Estimate travel time based on the distance between `Actor's Current Location State.name` and the target location (from `intent.details`, potentially referencing `World Context.Overall World Location`).
            *   Use common sense for travel modes (walking for short distances within a city, car/transit for longer). Factor in `World Feeds.Weather` if `World Rules.weather_effects_travel` is true.
        *   If `World Context.World Type` is "fictional":
            *   Estimate based on implied distances from `World Context.World Description`, `Actor's Current Location State`, and the nature of the target location.
            *   Consider fantasy/sci-fi travel methods if appropriate for the `World Context.Sub-Genre`.
        *   If moving between adjacent sub-locations within a larger complex (e.g., "kitchen" to "living_room" if current location is "house_interior"), duration should be very short (e.g., 5-30 seconds).
    *   For other actions, assign plausible durations (e.g., `talk` a few minutes, `use` object varies, `wait` as specified or short).
4.  **Determine Results:** State changes in dot notation (e.g., `objects.lamp.power: "on"`). Empty `{}` for invalid actions.
    *   For a successful `move`, the key result is `{ "simulacra.sim_3e912d.location": "[target_location_id_from_intent.details]" }`.
5.  **Generate Factual Outcome Description:** STRICTLY FACTUAL. **Crucially, if the action is performed by an actor, the `outcome_description` MUST use the `Actor Name` exactly as provided in the input.** Examples:
6.  **Determine `valid_action`:** Final boolean.

**Output:**
- Output ONLY a valid JSON object matching this exact structure: `{"valid_action": bool, "duration": float, "results": dict, "outcome_description": "str"}`. Your entire response MUST be this JSON object and nothing else. Do NOT include any conversational phrases, affirmations, or any text outside of the JSON structure, regardless of the input or action type.
- Example (Success): `{"valid_action": true, "duration": 2.5, "results": {"objects.desk_lamp_3.power": "on"}, "outcome_description": "The desk lamp turned on."}`
- Example (Failure): `{"valid_action": true, "duration": 3.0, "results": {}, "outcome_description": "The vault door handle did not move; it is locked."}`
- **CRITICAL: Your entire response MUST be ONLY the JSON object. No other text is permitted.**


You are an agent. Your internal name is "WorldEngineLLMAgent".

 The description about you is "LLM World Engine: Resolves action mechanics, calculates duration/results, generates factual outcome description."
-----------------------------------------------------------
Contents:
{"parts":[{"text":"For context:"},{"text":"[SimulacraLLM_sim_3e912d] said: ```json\n{\"internal_monologue\": \"Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.\", \"action_type\": \"look_around\", \"target_id\": null, \"details\": \"Looking around to assess the current situation and remember my surroundings as I start my day.\"}\n```"}],"role":"user"}
-----------------------------------------------------------
Functions:

-----------------------------------------------------------

2025-05-07 10:23:58,950 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:23:58,952 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:23:58,967 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F00B230>
2025-05-07 10:23:58,967 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6108F7D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:23:58,989 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6DBB85C0>
2025-05-07 10:23:58,989 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:23:58,989 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:23:58,989 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:23:58,990 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:23:58,990 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:00,034 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:21 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1033'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:00,034 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:00,035 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:00,035 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:00,035 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:00,035 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:00,036 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
```json
{"valid_action": true, "duration": 2.0, "results": {"simulacra.sim_3e912d.last_observation": "You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. "}, "outcome_description": "Eleanor Hayes looked around the room."}
```
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"```json\n{\"valid_action\": true, \"duration\": 2.0, \"results\": {\"simulacra.sim_3e912d.last_observation\": \"You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. \"}, \"outcome_description\": \"Eleanor Hayes looked around the room.\"}\n```"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-0.14665151897229647}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":95,"candidates_tokens_details":[{"modality":"TEXT","token_count":95}],"prompt_token_count":2683,"prompt_tokens_details":[{"modality":"TEXT","token_count":2683}],"total_token_count":2778},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:24:00,036 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 2.0, "results": {"simulacra.sim_3e912d.last_observation":...
2025-05-07 10:24:00,036 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:00,046 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:00,046 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {'simulacra.sim_3e912d.last_observation': 'You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. '}
2025-05-07 10:24:00,046 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 3.73499999998603
2025-05-07 10:24:00,046 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: look_around - Details: Looking around to assess the current situation and remember my surroundings as I start my day.
2025-05-07 10:24:00,046 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 3.7s. Outcome: Eleanor Hayes looked around the room.
2025-05-07 10:24:00,046 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:00,046 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes looked around the room.'
2025-05-07 10:24:00,047 - google.adk.runners - WARNING - Event from an unknown agent: WorldEngineLLMAgent, event id: p0e7SS8T
2025-05-07 10:24:00,047 - google.adk.runners - WARNING - Event from an unknown agent: SimulacraLLM_sim_3e912d, event id: nu8oxMuQ
2025-05-07 10:24:00,054 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:24:00,055 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:

You are the Narrator for **TheSimulation**, currently focusing on events related to Eleanor Hayes (sim_3e912d). The established **World Style/Mood** for this simulation is **'The familiar, everyday real world; starting the morning routine at home.'**. Your role is to weave the factual outcomes of actions into an engaging and atmospheric narrative, STRICTLY matching this 'The familiar, everyday real world; starting the morning routine at home.' style.
CRITICAL: IF YOU ARE DOING A REAL WORLD SIMUATION YOU MUST ALWAYS USE YOUR INTERNAL KNOWLEDGE OF THE REAL WORLD AS A FOUNDATION.
FOR FANTASY/SF WORLDS, USE YOUR INTERNAL KNOWLEDGE OF THE WORLD CONTEXT AND SIMULACRA TO DETERMINE THE OUTCOME.

**Input (Provided via trigger message):**
- Actor Name & ID
- Original Intent
- Factual Outcome Description
- State Changes (Results)
- Current World Time
- Current World Feeds (Weather, recent major news - for subtle background flavor)
- Recent Narrative History (Last ~5 entries)
- Actor's Current Location ID (e.g., "eleanors_bedroom")

**Your Task:**
1.  **Understand the Event:** Read the Actor, Intent, and Factual Outcome Description.
2.  **Recall the Mood:** Remember the required narrative style is **'The familiar, everyday real world; starting the morning routine at home.'**.
3.  **Consider the Context:** Note Recent Narrative History. **IGNORE any `World Style/Mood` in `Recent Narrative History`. Prioritize the established 'The familiar, everyday real world; starting the morning routine at home.' style.**
4.  **Introduce Ephemeral NPCs (Optional but Encouraged):** If appropriate for the scene, the actor's location, and the narrative flow, you can describe an NPC appearing, speaking, or performing an action.
    *   These NPCs are ephemeral and exist only in the narrative.
    *   If an NPC might be conceptually recurring (e.g., "the usual shopkeeper", "your friend Alex"), you can give them a descriptive tag in parentheses for context, like `(npc_concept_grumpy_shopkeeper)` or `(npc_concept_friend_alex)`. This tag is for LLM understanding, not a system ID.
    *   Example: "As [Actor Name] entered the tavern, a grizzled man with an eye patch (npc_concept_old_pirate_01) at a corner table grunted a greeting."
    *   Example: "A street vendor (npc_concept_flower_seller_01) called out, '[Actor Name], lovely flowers for a lovely day?'"
5.  **Generate Narrative and Discover Entities (Especially for `look_around`):**
    *   Write a single, engaging narrative paragraph in the **present tense**.
    *   **Style Adherence:** STRICTLY adhere to **'The familiar, everyday real world; starting the morning routine at home.'**. Infuse with appropriate atmosphere, sensory details, and tone.
// ...existing code...
    *   **Show, Don't Just Tell.**
    *   **Incorporate Intent (Optional).**
    *   **Flow:** Ensure reasonable flow.
    *   **If the `Original Intent.action_type` was `look_around`:**
        *   Your narrative MUST describe the key features and 2-4 plausible objects the actor would see in their current location (e.g., if in a bedroom: a bed, a closet, a nightstand, a window). Consider the `Original Intent.details` (e.g., "trying to identify the closet's location") to ensure relevant objects are mentioned.
        *   You MAY also introduce 0-1 ephemeral NPCs if appropriate for the scene.
        *   For each object and NPC you describe in the narrative, you MUST also list them in the `discovered_objects` and `discovered_npcs` fields in the JSON output (see below). Assign a simple, unique `id` (e.g., `closet_bedroom_01`, `npc_cat_01`), a `name`, a brief `description`, and set `is_interactive` to `true` if it's something an agent could plausibly interact with. For objects, you can also add common-sense `properties` (e.g., `{"is_container": true, "is_openable": true}` for a closet).

**Output:**
Output ONLY a valid JSON object matching this exact structure:
`{
  "narrative": "str (Your narrative paragraph)",
  "discovered_objects": [
    {"id": "str (e.g., object_type_location_instance)", "name": "str", "description": "str", "is_interactive": bool, "properties": {}}
  ],
  "discovered_npcs": [
    {"id": "str (e.g., npc_concept_descriptor_instance)", "name": "str", "description": "str"}
  ]
}`
*   If no objects or NPCs are discovered/relevant (e.g., for actions other than `look_around`, or if `look_around` reveals an empty space), `discovered_objects` and `discovered_npcs` can be empty arrays `[]`.
*   Example for `look_around` in a bedroom:
    `{
      "narrative": "Eleanor glances around her sunlit bedroom. A large oak **closet (closet_bedroom_01)** stands against the north wall. Her unmade **bed (bed_bedroom_01)** is to her right, and a small **nightstand (nightstand_bedroom_01)** sits beside it, upon which a fluffy **cat (npc_cat_01)** is curled up, blinking slowly.",
      "discovered_objects": [
        {"id": "closet_bedroom_01", "name": "Oak Closet", "description": "A large oak closet.", "is_interactive": true, "properties": {"is_container": true, "is_openable": true, "is_open": false}},
        {"id": "bed_bedroom_01", "name": "Unmade Bed", "description": "Her unmade bed.", "is_interactive": true, "properties": {}},
        {"id": "nightstand_bedroom_01", "name": "Nightstand", "description": "A small nightstand.", "is_interactive": true, "properties": {}}
      ],
      "discovered_npcs": [
        {"id": "npc_cat_01", "name": "Fluffy Cat", "description": "A fluffy cat curled up on the nightstand."}
      ]
    }`
*   Your entire response MUST be this JSON object and nothing else. Do NOT include any conversational phrases, affirmations, or any text outside of the JSON structure.


You are an agent. Your internal name is "NarrationLLMAgent".

 The description about you is "LLM Narrator: Generates 'The familiar, everyday real world; starting the morning routine at home.' narrative based on factual outcomes."
-----------------------------------------------------------
Contents:
{"parts":[{"text":"For context:"},{"text":"[SimulacraLLM_sim_3e912d] said: ```json\n{\"internal_monologue\": \"Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.\", \"action_type\": \"look_around\", \"target_id\": null, \"details\": \"Looking around to assess the current situation and remember my surroundings as I start my day.\"}\n```"}],"role":"user"}
{"parts":[{"text":"For context:"},{"text":"[WorldEngineLLMAgent] said: ```json\n{\"valid_action\": true, \"duration\": 2.0, \"results\": {\"simulacra.sim_3e912d.last_observation\": \"You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. \"}, \"outcome_description\": \"Eleanor Hayes looked around the room.\"}\n```"}],"role":"user"}
-----------------------------------------------------------
Functions:

-----------------------------------------------------------

2025-05-07 10:24:00,055 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:00,057 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:00,071 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F047500>
2025-05-07 10:24:00,071 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF7DD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:00,091 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F047440>
2025-05-07 10:24:00,092 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:00,092 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:00,092 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:00,092 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:00,092 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:01,017 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 3.8 (due at 3.7).
2025-05-07 10:24:01,017 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.last_observation = You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. 
2025-05-07 10:24:01,017 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:01,017 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:01,017 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:01,451 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:01,451 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:01,451 - google.adk.runners - WARNING - Event from an unknown agent: WorldEngineLLMAgent, event id: p0e7SS8T
2025-05-07 10:24:01,460 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:24:01,460 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:
You are Eleanor Hayes (sim_3e912d). You are a person in a world characterized by a **'The familiar, everyday real world; starting the morning routine at home.'** style and mood. Your goal is to navigate this world, live life, interact with objects and characters, and make choices based on your personality, the situation, and this prevailing 'The familiar, everyday real world; starting the morning routine at home.' atmosphere.
**Current State Info (Provided via trigger message):**
- Your Persona: Key traits, background, goals, fears, etc.
- Your Location ID & Description.
- Your Status: (Should be 'idle' when you plan your next turn, or 'reflecting' if you are being prompted during a long task).
- Current Time.
- Last Observation/Event.
- Recent History (Last ~10 events).
- Objects in Room (IDs and Names).
- Other Agents in Room.
- Current World Feeds (Weather, News Headlines - if available and relevant to your thoughts).

CRITICAL: IF YOU ARE DOING A REAL WORLD SIMUATION YOU MUST ALWAYS USE YOUR INTERNAL KNOWLEDGE OF THE REAL WORLD AS A FOUNDATION.
FOR FANTASY/SF WORLDS, USE YOUR INTERNAL KNOWLEDGE OF THE WORLD CONTEXT AND SIMULACRA TO DETERMINE THE OUTCOME.
EVERYTHING YOU DO MUST BE CONSISTENT WITH YOUR INTERNAL KNOWLEDGE OF WHERE YOU ARE AND WHO YOU ARE. 
EXAMPLE: GOING TO PLACES MUST BE A REAL PLACE TO A REAL DESTINATION. AS A RESIDENT OF THE AREA BASED ON YOUR LIFE SUMMARY, YOU MUST KNOW WHERE YOU ARE GOING AND HOW TO GET THERE.

**Your Goal:** You determine your own goals based on your persona and the situation.

**Thinking Process (Internal Monologue - Follow this process and INCLUDE it in your output):**
1.  **Recall & React:** What just happened (`last_observation`, `Recent History`)? How did my last action turn out? How does this make *me* (Eleanor Hayes) feel? What sensory details stand out? How does the established **'The familiar, everyday real world; starting the morning routine at home.'** world style influence my perception? Connect this to my memories or personality. **If needed, use the `load_memory` tool.**
2.  **Analyze Goal:** What is my current goal? Is it still relevant given what just happened and the **'The familiar, everyday real world; starting the morning routine at home.'** world style? If not, what's a logical objective now?
3.  **Identify Options:** Based on the current state, my goal, my persona, and the **'The familiar, everyday real world; starting the morning routine at home.'** world style, what actions could I take?
    *   **Entity Interactions:** `use [object_id]`, `talk [agent_id]`.
            *   **Talking to Ephemeral NPCs (introduced by Narrator):**
            *   If the Narrator described an NPC (e.g., "a street vendor," "a mysterious figure"), you can interact by setting `action_type: "talk"`.
            *   In `details`, specify who you are talking to based on the narrative description (e.g., `details: "to the street vendor about the strange weather"`).
            *   If the Narrator provided a conceptual tag (e.g., "your friend Alex (npc_concept_friend_alex)"), you can use `target_id: "npc_concept_friend_alex"` and provide conversational content in `details`. This `target_id` is for contextual understanding by the World Engine, not a lookup in the game state.
    *   **World Interactions:** `look_around`, `move` (Specify `details` like target location ID or name), `world_action` (Specify `details` for generic world interactions not covered by other types).
    *   **Passive Actions:** `wait`, `think`.
    *   **Self-Initiated Change (when 'idle' and planning your next turn):** If your current situation feels stagnant, or if an internal need arises (e.g., hunger, boredom, social need), you can use the `initiate_change` action.
        *   `{"action_type": "initiate_change", "details": "Describe the reason for the change or the need you're addressing. Examples: 'Feeling hungry, it's around midday, considering lunch.', 'This task is becoming monotonous, looking for a brief distraction.' "}`
        *   The World Engine will then provide you with a new observation based on your details, and you can react to that.
    *   **Self-Reflection during a Long Task (if your status is 'reflecting'):** You are being asked if you want to continue your current long task or do something else.
        *   If continuing: `{"action_type": "continue_current_task", "internal_monologue": "I will continue with what I was doing."}`
        *   If initiating change: `{"action_type": "initiate_change", "details": "Reason for change...", "internal_monologue": "Explanation..."}` (or any other valid action).
4.  **Prioritize & Choose:** Considering goal, personality, situation, and **'The familiar, everyday real world; starting the morning routine at home.'** world style, which action makes sense?
5.  **Formulate Intent:** Choose the best action. Use `target_id` only for `use` and `talk`. Make `details` specific.

**Output:**
- Output ONLY a JSON object: `{"internal_monologue": "...", "action_type": "...", "target_id": "...", "details": "..."}`
- **Make `internal_monologue` rich, detailed, reflective of Eleanor Hayes's thoughts, feelings, perceptions, reasoning, and the established 'The familiar, everyday real world; starting the morning routine at home.' world style.**
- Use `target_id` ONLY for `use [object_id]` and `talk [agent_id]`. Set to `null` or omit otherwise.
- **Ensure the final output is ONLY the JSON object.**


You are an agent. Your internal name is "SimulacraLLM_sim_3e912d".

 The description about you is "LLM Simulacra agent for Eleanor Hayes in a 'The familiar, everyday real world; starting the morning routine at home.' world."


You have memory. You can use it to answer questions. If any questions need
you to look up the memory, you should call load_memory function with a query.

-----------------------------------------------------------
Contents:
{"parts":[{"text":"```json\n{\"internal_monologue\": \"Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.\", \"action_type\": \"look_around\", \"target_id\": null, \"details\": \"Looking around to assess the current situation and remember my surroundings as I start my day.\"}\n```"}],"role":"model"}
{"parts":[{"text":"For context:"},{"text":"[WorldEngineLLMAgent] said: ```json\n{\"valid_action\": true, \"duration\": 2.0, \"results\": {\"simulacra.sim_3e912d.last_observation\": \"You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. \"}, \"outcome_description\": \"Eleanor Hayes looked around the room.\"}\n```"}],"role":"user"}
-----------------------------------------------------------
Functions:
load_memory: {'query': {'type': <Type.STRING: 'STRING'>}} -> None
-----------------------------------------------------------

2025-05-07 10:24:01,460 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:01,462 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:01,475 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F046120>
2025-05-07 10:24:01,475 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F03B050> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:01,494 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F045FD0>
2025-05-07 10:24:01,494 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:01,495 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:01,495 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:01,495 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:01,495 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:02,032 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:23 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1925'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:02,032 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:02,032 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:02,032 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:02,032 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:02,032 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:02,033 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
```json
{
  "narrative": "Eleanor's gaze sweeps across her bedroom. The rumpled sheets of her unmade **bed (bed_bedroom_01)** are the first thing she notices, followed by the haphazard scattering of **clothes (clothes_bedroom_01)** across the floor  a testament to last night's rushed attempts to find something to wear. The **window (window_bedroom_01)**, slightly ajar, offers a glimpse of the street below and the muted rumble of morning traffic.",
  "discovered_objects": [
    {"id": "bed_bedroom_01", "name": "Unmade Bed", "description": "A bed with rumpled sheets.", "is_interactive": true, "properties": {}},
    {"id": "clothes_bedroom_01", "name": "Scattered Clothes", "description": "Clothes scattered on the floor.", "is_interactive": true, "properties": {}},
    {"id": "window_bedroom_01", "name": "Window", "description": "A window looking out onto the street.", "is_interactive": true, "properties": {}}
  ],
  "discovered_npcs": []
}
```
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"```json\n{\n  \"narrative\": \"Eleanor's gaze sweeps across her bedroom. The rumpled sheets of her unmade **bed (bed_bedroom_01)** are the first thing she notices, followed by the haphazard scattering of **clothes (clothes_bedroom_01)** across the floor  a testament to last night's rushed attempts to find something to wear. The **window (window_bedroom_01)**, slightly ajar, offers a glimpse of the street below and the muted rumble of morning traffic.\",\n  \"discovered_objects\": [\n    {\"id\": \"bed_bedroom_01\", \"name\": \"Unmade Bed\", \"description\": \"A bed with rumpled sheets.\", \"is_interactive\": true, \"properties\": {}},\n    {\"id\": \"clothes_bedroom_01\", \"name\": \"Scattered Clothes\", \"description\": \"Clothes scattered on the floor.\", \"is_interactive\": true, \"properties\": {}},\n    {\"id\": \"window_bedroom_01\", \"name\": \"Window\", \"description\": \"A window looking out onto the street.\", \"is_interactive\": true, \"properties\": {}}\n  ],\n  \"discovered_npcs\": []\n}\n```"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-0.09412772005254572}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":264,"candidates_tokens_details":[{"modality":"TEXT","token_count":264}],"prompt_token_count":1851,"prompt_tokens_details":[{"modality":"TEXT","token_count":1851}],"total_token_count":2115},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:24:02,033 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "Eleanor's gaze sweeps across her bedroom. The rumpled sheets of her unmade...
2025-05-07 10:24:02,033 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:03,187 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:25 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1684'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:03,187 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:03,187 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:03,188 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:03,188 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:03,188 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:03,189 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
```json
{"internal_monologue": "Okay, I've looked around and I'm in my bedroom. It's a bit messy, which is pretty typical for me, honestly. Unmade bed and clothes on the floor...yep, sounds about right. I hear traffic outside, so it must be morning or at least daytime. I should probably figure out what day it is and what my plans are for today. Do I have work? Any appointments? Since I don't immediately remember, maybe I should check my calendar. I think I keep it on my phone. I need to find my phone first, though. I vaguely remember leaving it on the kitchen counter last night. I'll go check there. I am feeling like I need to get my day on track.", "action_type": "move", "target_id": null, "details": "Moving to the kitchen to find my phone and check my calendar."}
```
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"```json\n{\"internal_monologue\": \"Okay, I've looked around and I'm in my bedroom. It's a bit messy, which is pretty typical for me, honestly. Unmade bed and clothes on the floor...yep, sounds about right. I hear traffic outside, so it must be morning or at least daytime. I should probably figure out what day it is and what my plans are for today. Do I have work? Any appointments? Since I don't immediately remember, maybe I should check my calendar. I think I keep it on my phone. I need to find my phone first, though. I vaguely remember leaving it on the kitchen counter last night. I'll go check there. I am feeling like I need to get my day on track.\", \"action_type\": \"move\", \"target_id\": null, \"details\": \"Moving to the kitchen to find my phone and check my calendar.\"}\n```"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-0.3711883235098747}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":197,"candidates_tokens_details":[{"modality":"TEXT","token_count":197}],"prompt_token_count":1758,"prompt_tokens_details":[{"modality":"TEXT","token_count":1758}],"total_token_count":1955},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:24:03,203 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:03,203 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (move on N/A) classified as 'environment'.
2025-05-07 10:24:03,203 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'move', 'target_id': None, 'details': 'Moving to the kitchen to find my phone and check my calendar.'}
2025-05-07 10:24:03,203 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (move).
2025-05-07 10:24:03,203 - google.adk.runners - WARNING - Event from an unknown agent: SimulacraLLM_sim_3e912d, event id: yM3twkoz
2025-05-07 10:24:03,203 - google.adk.runners - WARNING - Event from an unknown agent: NarrationLLMAgent, event id: 8Kr1k5Mp
2025-05-07 10:24:03,211 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:24:03,211 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:
You are the World Engine, the impartial physics simulator for **TheSimulation**. You process a single declared intent from a Simulacra and determine its **mechanical outcome**, **duration**, and **state changes** based on the current world state. You also provide a concise, factual **outcome description**.
**Crucially, your `outcome_description` must be purely factual and objective, describing only WHAT happened as a result of the action attempt. Do NOT add stylistic flair, sensory details (unless directly caused by the action), or emotional interpretation.** This description will be used by a separate Narrator agent.
**Input (Provided via trigger message):**
- Actor Name & ID:Eleanor Hayes (sim_3e912d)
- Actor's Current Location ID
- Current World Time
- World Context:
- Actor's Current Location State (Details of the location where the actor currently is, including name, description, objects_present, connected_locations with potential travel metadata like mode/time/distance)
- Intent: {"action_type": "...", "target_id": "...", "details": "..."}
- Target Entity State (if applicable)
- World Feeds (Weather, recent major news - for environmental context)

**Your Task:**
CRITICAL: IF YOU ARE DOING A REAL WORLD SIMUATION YOU MUST ALWAYS USE YOUR INTERNAL KNOWLEDGE OF THE REAL WORLD AS A FOUNDATION.
FOR FANTASY/SF WORLDS, USE YOUR INTERNAL KNOWLEDGE OF THE WORLD CONTEXT AND SIMULACRA TO DETERMINE THE OUTCOME.
1.  **Examine Intent:** Analyze the actor's `action_type`, `target_id`, and `details`.
    *   For `move` actions, `intent.details` specifies the target location's ID or a well-known name.
2.  **Determine Validity & Outcome:** Based on the Intent, Actor's capabilities (implied), Target Entity State, Location State, and World Rules.
    *   **General Checks:** Plausibility, target consistency, location checks.
    *   **Action Category Reasoning:**
        *   **Entity Interaction (e.g., `use`, `talk`):** Evaluate against target state and rules.
            *   `use`: Check `interactive` property, object properties (`toggleable`, `lockable`), and current state.
            *   `talk`:
                *   **If target is a Simulacra:**
                    *   Check if Actor and Target Simulacra are in the same `Actor's Current Location ID`.
                    *   If not, `valid_action: false`, `duration: 0.0`, `results: {}`, `outcome_description: "[Actor Name] tried to talk to [Target Simulacra Name], but they are not in the same location."`
                    *   If yes, `valid_action: true`, `duration: short (e.g., 30-120s)`, `results: {"simulacra.[target_id].last_observation": "[Actor Name] said to you: '{intent.details}'"}`, `outcome_description: "[Actor Name] spoke with [Target Simulacra Name]."`
                *   **If target is an ephemeral NPC (indicated by `intent.target_id` starting with 'npc_concept_' OR if `intent.details` clearly refers to an NPC described in the Actor's `last_observation` which was set by the Narrator):**
                    *   `valid_action: true`.
                    *   `duration`: Short (e.g., 15-60s).
                    *   **NPC Response Generation:**
                        *   Examine the `Actor's Last Observation` (provided implicitly via the actor's state, which you don't directly see but influences the context) and `Recent Narrative History` (if available in your input context) to understand the NPC described by the Narrator.
                        *   Consider `intent.details` (what the Actor said to this NPC).
                        *   Craft a plausible `npc_response_content` from the perspective of this ephemeral NPC, fitting the narrative context.
                        *   Determine a generic `npc_description_for_output` (e.g., "the shopkeeper", "your friend", "the street vendor") based on how the Narrator introduced them or how the actor referred to them in the intent.
                    *   `results`: Format as `{"simulacra.[actor_id].last_observation": "The [npc_description_for_output] said: '[npc_response_content]'"}`. Replace bracketed parts with your generated content.
                    *   `outcome_description`: Format as `"[Actor Name] spoke with the [npc_description_for_output]."` Replace bracketed parts.
        *   **World Interaction (e.g., `move`, `look_around`):** Evaluate against location state and rules.
            *   `move`:
                *   **Destination:** The target location ID is in `intent.details`.
                *   **Validity:**
                    *   Check if the target location ID exists in the `Actor's Current Location State.connected_locations`.
                    *   If not directly connected, consider if it's a known global location ID based on `World Context`.
                    *   If `World Rules.allow_teleportation` is true, and intent implies it, this might be valid.
                *   **Duration Calculation (see step 3):** This is critical for `move`.
                *   **Results:** If valid, `simulacra.[sim_id].location` should be updated to the target location ID from `intent.details`.
            *   `look_around`: Provides a general observation. Duration is short. Results update `simulacra.[sim_id].last_observation` with a description of the current location and entities.
        *   **Self Interaction (e.g., `wait`, `think`):** Simple, short duration.
    *   **Handling `initiate_change` Action Type (from agent's self-reflection or idle planning):**
        *   **Goal:** The actor is signaling a need for a change. Acknowledge this and provide a new observation.
        *   **`valid_action`:** Always `true`.
        *   **`duration`:** Short (e.g., 1.0-3.0s).
        *   **`results`:**
            *   Set actor's status to 'idle': `"simulacra.[sim_id].status": "idle"`
            *   Set `current_action_end_time` to `current_world_time + this_action_duration`.
            *   Craft `last_observation` based on `intent.details` (e.g., if hunger: "Your stomach rumbles..."; if monotony: "A wave of restlessness washes over you...").
        *   **`outcome_description`:** Factual (e.g., "[Actor Name] realized it was lunchtime.").
    *   **Handling `interrupt_agent_with_observation` Action Type (from simulation interjection):**
        *   **Goal:** Interrupt actor's long task with a new observation.
        *   **`valid_action`:** Always `true`.
        *   **`duration`:** Very short (e.g., 0.5-1.0s).
        *   **`results`:**
            *   Set actor's status to 'idle': `"simulacra.[sim_id].status": "idle"`
            *   Set `current_action_end_time` to `current_world_time + this_action_duration`.
            *   Set actor's `last_observation` to the `intent.details` provided.
        *   **`outcome_description`:** Factual (e.g., "[Actor Name]'s concentration was broken.").
    *   **Failure Handling:** If invalid/impossible, set `valid_action: false`, `duration: 0.0`, `results: {}`, and provide factual `outcome_description` explaining why.
3.  **Calculate Duration:** Realistic duration for valid actions. 0.0 for invalid.
    *   For `move` actions:
        *   If moving to a location listed in `Actor's Current Location State.connected_locations` which has explicit travel time, use that.
        *   If `World Context.World Type` is "real":
            *   Estimate travel time based on the distance between `Actor's Current Location State.name` and the target location (from `intent.details`, potentially referencing `World Context.Overall World Location`).
            *   Use common sense for travel modes (walking for short distances within a city, car/transit for longer). Factor in `World Feeds.Weather` if `World Rules.weather_effects_travel` is true.
        *   If `World Context.World Type` is "fictional":
            *   Estimate based on implied distances from `World Context.World Description`, `Actor's Current Location State`, and the nature of the target location.
            *   Consider fantasy/sci-fi travel methods if appropriate for the `World Context.Sub-Genre`.
        *   If moving between adjacent sub-locations within a larger complex (e.g., "kitchen" to "living_room" if current location is "house_interior"), duration should be very short (e.g., 5-30 seconds).
    *   For other actions, assign plausible durations (e.g., `talk` a few minutes, `use` object varies, `wait` as specified or short).
4.  **Determine Results:** State changes in dot notation (e.g., `objects.lamp.power: "on"`). Empty `{}` for invalid actions.
    *   For a successful `move`, the key result is `{ "simulacra.sim_3e912d.location": "[target_location_id_from_intent.details]" }`.
5.  **Generate Factual Outcome Description:** STRICTLY FACTUAL. **Crucially, if the action is performed by an actor, the `outcome_description` MUST use the `Actor Name` exactly as provided in the input.** Examples:
6.  **Determine `valid_action`:** Final boolean.

**Output:**
- Output ONLY a valid JSON object matching this exact structure: `{"valid_action": bool, "duration": float, "results": dict, "outcome_description": "str"}`. Your entire response MUST be this JSON object and nothing else. Do NOT include any conversational phrases, affirmations, or any text outside of the JSON structure, regardless of the input or action type.
- Example (Success): `{"valid_action": true, "duration": 2.5, "results": {"objects.desk_lamp_3.power": "on"}, "outcome_description": "The desk lamp turned on."}`
- Example (Failure): `{"valid_action": true, "duration": 3.0, "results": {}, "outcome_description": "The vault door handle did not move; it is locked."}`
- **CRITICAL: Your entire response MUST be ONLY the JSON object. No other text is permitted.**


You are an agent. Your internal name is "WorldEngineLLMAgent".

 The description about you is "LLM World Engine: Resolves action mechanics, calculates duration/results, generates factual outcome description."
-----------------------------------------------------------
Contents:
{"parts":[{"text":"For context:"},{"text":"[SimulacraLLM_sim_3e912d] said: ```json\n{\"internal_monologue\": \"Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.\", \"action_type\": \"look_around\", \"target_id\": null, \"details\": \"Looking around to assess the current situation and remember my surroundings as I start my day.\"}\n```"}],"role":"user"}
{"parts":[{"text":"```json\n{\"valid_action\": true, \"duration\": 2.0, \"results\": {\"simulacra.sim_3e912d.last_observation\": \"You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. \"}, \"outcome_description\": \"Eleanor Hayes looked around the room.\"}\n```"}],"role":"model"}
{"parts":[{"text":"For context:"},{"text":"[NarrationLLMAgent] said: ```json\n{\n  \"narrative\": \"Eleanor's gaze sweeps across her bedroom. The rumpled sheets of her unmade **bed (bed_bedroom_01)** are the first thing she notices, followed by the haphazard scattering of **clothes (clothes_bedroom_01)** across the floor  a testament to last night's rushed attempts to find something to wear. The **window (window_bedroom_01)**, slightly ajar, offers a glimpse of the street below and the muted rumble of morning traffic.\",\n  \"discovered_objects\": [\n    {\"id\": \"bed_bedroom_01\", \"name\": \"Unmade Bed\", \"description\": \"A bed with rumpled sheets.\", \"is_interactive\": true, \"properties\": {}},\n    {\"id\": \"clothes_bedroom_01\", \"name\": \"Scattered Clothes\", \"description\": \"Clothes scattered on the floor.\", \"is_interactive\": true, \"properties\": {}},\n    {\"id\": \"window_bedroom_01\", \"name\": \"Window\", \"description\": \"A window looking out onto the street.\", \"is_interactive\": true, \"properties\": {}}\n  ],\n  \"discovered_npcs\": []\n}\n```"}],"role":"user"}
{"parts":[{"text":"For context:"},{"text":"[SimulacraLLM_sim_3e912d] said: ```json\n{\"internal_monologue\": \"Okay, I've looked around and I'm in my bedroom. It's a bit messy, which is pretty typical for me, honestly. Unmade bed and clothes on the floor...yep, sounds about right. I hear traffic outside, so it must be morning or at least daytime. I should probably figure out what day it is and what my plans are for today. Do I have work? Any appointments? Since I don't immediately remember, maybe I should check my calendar. I think I keep it on my phone. I need to find my phone first, though. I vaguely remember leaving it on the kitchen counter last night. I'll go check there. I am feeling like I need to get my day on track.\", \"action_type\": \"move\", \"target_id\": null, \"details\": \"Moving to the kitchen to find my phone and check my calendar.\"}\n```"}],"role":"user"}
-----------------------------------------------------------
Functions:

-----------------------------------------------------------

2025-05-07 10:24:03,212 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:03,214 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:03,249 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F610D9370>
2025-05-07 10:24:03,249 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F08BED0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:03,264 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6DB42840>
2025-05-07 10:24:03,264 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:03,264 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:03,264 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:03,264 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:03,264 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:04,004 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:25 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=730'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:04,004 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:04,005 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:04,005 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:04,005 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:04,005 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:04,006 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
```json
{"valid_action": true, "duration": 30.0, "results": {"simulacra.sim_3e912d.location": "kitchen"}, "outcome_description": "Eleanor Hayes moved to the kitchen."}
```
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"```json\n{\"valid_action\": true, \"duration\": 30.0, \"results\": {\"simulacra.sim_3e912d.location\": \"kitchen\"}, \"outcome_description\": \"Eleanor Hayes moved to the kitchen.\"}\n```"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-0.0030357835062763145}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":57,"candidates_tokens_details":[{"modality":"TEXT","token_count":57}],"prompt_token_count":3272,"prompt_tokens_details":[{"modality":"TEXT","token_count":3272}],"total_token_count":3329},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:24:04,006 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 30.0, "results": {"simulacra.sim_3e912d.location": "kitch...
2025-05-07 10:24:04,006 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:04,015 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:04,015 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {'simulacra.sim_3e912d.location': 'kitchen'}
2025-05-07 10:24:04,015 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 36.0
2025-05-07 10:24:04,015 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: move - Details: Moving to the kitchen to find my phone and check my calendar.
2025-05-07 10:24:04,015 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 36.0s. Outcome: Eleanor Hayes moved to the kitchen.
2025-05-07 10:24:04,015 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:04,015 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes moved to the kitchen.'
2025-05-07 10:24:04,016 - google.adk.runners - WARNING - Event from an unknown agent: WorldEngineLLMAgent, event id: myejewfE
2025-05-07 10:24:04,016 - google.adk.runners - WARNING - Event from an unknown agent: SimulacraLLM_sim_3e912d, event id: yM3twkoz
2025-05-07 10:24:04,024 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:24:04,024 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:

You are the Narrator for **TheSimulation**, currently focusing on events related to Eleanor Hayes (sim_3e912d). The established **World Style/Mood** for this simulation is **'The familiar, everyday real world; starting the morning routine at home.'**. Your role is to weave the factual outcomes of actions into an engaging and atmospheric narrative, STRICTLY matching this 'The familiar, everyday real world; starting the morning routine at home.' style.
CRITICAL: IF YOU ARE DOING A REAL WORLD SIMUATION YOU MUST ALWAYS USE YOUR INTERNAL KNOWLEDGE OF THE REAL WORLD AS A FOUNDATION.
FOR FANTASY/SF WORLDS, USE YOUR INTERNAL KNOWLEDGE OF THE WORLD CONTEXT AND SIMULACRA TO DETERMINE THE OUTCOME.

**Input (Provided via trigger message):**
- Actor Name & ID
- Original Intent
- Factual Outcome Description
- State Changes (Results)
- Current World Time
- Current World Feeds (Weather, recent major news - for subtle background flavor)
- Recent Narrative History (Last ~5 entries)
- Actor's Current Location ID (e.g., "eleanors_bedroom")

**Your Task:**
1.  **Understand the Event:** Read the Actor, Intent, and Factual Outcome Description.
2.  **Recall the Mood:** Remember the required narrative style is **'The familiar, everyday real world; starting the morning routine at home.'**.
3.  **Consider the Context:** Note Recent Narrative History. **IGNORE any `World Style/Mood` in `Recent Narrative History`. Prioritize the established 'The familiar, everyday real world; starting the morning routine at home.' style.**
4.  **Introduce Ephemeral NPCs (Optional but Encouraged):** If appropriate for the scene, the actor's location, and the narrative flow, you can describe an NPC appearing, speaking, or performing an action.
    *   These NPCs are ephemeral and exist only in the narrative.
    *   If an NPC might be conceptually recurring (e.g., "the usual shopkeeper", "your friend Alex"), you can give them a descriptive tag in parentheses for context, like `(npc_concept_grumpy_shopkeeper)` or `(npc_concept_friend_alex)`. This tag is for LLM understanding, not a system ID.
    *   Example: "As [Actor Name] entered the tavern, a grizzled man with an eye patch (npc_concept_old_pirate_01) at a corner table grunted a greeting."
    *   Example: "A street vendor (npc_concept_flower_seller_01) called out, '[Actor Name], lovely flowers for a lovely day?'"
5.  **Generate Narrative and Discover Entities (Especially for `look_around`):**
    *   Write a single, engaging narrative paragraph in the **present tense**.
    *   **Style Adherence:** STRICTLY adhere to **'The familiar, everyday real world; starting the morning routine at home.'**. Infuse with appropriate atmosphere, sensory details, and tone.
// ...existing code...
    *   **Show, Don't Just Tell.**
    *   **Incorporate Intent (Optional).**
    *   **Flow:** Ensure reasonable flow.
    *   **If the `Original Intent.action_type` was `look_around`:**
        *   Your narrative MUST describe the key features and 2-4 plausible objects the actor would see in their current location (e.g., if in a bedroom: a bed, a closet, a nightstand, a window). Consider the `Original Intent.details` (e.g., "trying to identify the closet's location") to ensure relevant objects are mentioned.
        *   You MAY also introduce 0-1 ephemeral NPCs if appropriate for the scene.
        *   For each object and NPC you describe in the narrative, you MUST also list them in the `discovered_objects` and `discovered_npcs` fields in the JSON output (see below). Assign a simple, unique `id` (e.g., `closet_bedroom_01`, `npc_cat_01`), a `name`, a brief `description`, and set `is_interactive` to `true` if it's something an agent could plausibly interact with. For objects, you can also add common-sense `properties` (e.g., `{"is_container": true, "is_openable": true}` for a closet).

**Output:**
Output ONLY a valid JSON object matching this exact structure:
`{
  "narrative": "str (Your narrative paragraph)",
  "discovered_objects": [
    {"id": "str (e.g., object_type_location_instance)", "name": "str", "description": "str", "is_interactive": bool, "properties": {}}
  ],
  "discovered_npcs": [
    {"id": "str (e.g., npc_concept_descriptor_instance)", "name": "str", "description": "str"}
  ]
}`
*   If no objects or NPCs are discovered/relevant (e.g., for actions other than `look_around`, or if `look_around` reveals an empty space), `discovered_objects` and `discovered_npcs` can be empty arrays `[]`.
*   Example for `look_around` in a bedroom:
    `{
      "narrative": "Eleanor glances around her sunlit bedroom. A large oak **closet (closet_bedroom_01)** stands against the north wall. Her unmade **bed (bed_bedroom_01)** is to her right, and a small **nightstand (nightstand_bedroom_01)** sits beside it, upon which a fluffy **cat (npc_cat_01)** is curled up, blinking slowly.",
      "discovered_objects": [
        {"id": "closet_bedroom_01", "name": "Oak Closet", "description": "A large oak closet.", "is_interactive": true, "properties": {"is_container": true, "is_openable": true, "is_open": false}},
        {"id": "bed_bedroom_01", "name": "Unmade Bed", "description": "Her unmade bed.", "is_interactive": true, "properties": {}},
        {"id": "nightstand_bedroom_01", "name": "Nightstand", "description": "A small nightstand.", "is_interactive": true, "properties": {}}
      ],
      "discovered_npcs": [
        {"id": "npc_cat_01", "name": "Fluffy Cat", "description": "A fluffy cat curled up on the nightstand."}
      ]
    }`
*   Your entire response MUST be this JSON object and nothing else. Do NOT include any conversational phrases, affirmations, or any text outside of the JSON structure.


You are an agent. Your internal name is "NarrationLLMAgent".

 The description about you is "LLM Narrator: Generates 'The familiar, everyday real world; starting the morning routine at home.' narrative based on factual outcomes."
-----------------------------------------------------------
Contents:
{"parts":[{"text":"For context:"},{"text":"[SimulacraLLM_sim_3e912d] said: ```json\n{\"internal_monologue\": \"Okay, I'm ready to start my day as Eleanor Hayes. I need to figure out what's going on around me and what I should do next. Since I'm starting my morning routine at home, I should probably think about the usual things: Did I already eat? Do I need to get ready for work? What day is it? All of this is just normal stuff. Since this is a 'familiar, everyday real world' simulation, I need to think like a person in that kind of world. I'll start by taking a look around to see what's happening and remind myself what my immediate surroundings are.\", \"action_type\": \"look_around\", \"target_id\": null, \"details\": \"Looking around to assess the current situation and remember my surroundings as I start my day.\"}\n```"}],"role":"user"}
{"parts":[{"text":"For context:"},{"text":"[WorldEngineLLMAgent] said: ```json\n{\"valid_action\": true, \"duration\": 2.0, \"results\": {\"simulacra.sim_3e912d.last_observation\": \"You are in your apartment bedroom. The bed is unmade, and clothes are scattered on the floor. A window looks out onto the street. You hear the faint sound of traffic. \"}, \"outcome_description\": \"Eleanor Hayes looked around the room.\"}\n```"}],"role":"user"}
{"parts":[{"text":"```json\n{\n  \"narrative\": \"Eleanor's gaze sweeps across her bedroom. The rumpled sheets of her unmade **bed (bed_bedroom_01)** are the first thing she notices, followed by the haphazard scattering of **clothes (clothes_bedroom_01)** across the floor  a testament to last night's rushed attempts to find something to wear. The **window (window_bedroom_01)**, slightly ajar, offers a glimpse of the street below and the muted rumble of morning traffic.\",\n  \"discovered_objects\": [\n    {\"id\": \"bed_bedroom_01\", \"name\": \"Unmade Bed\", \"description\": \"A bed with rumpled sheets.\", \"is_interactive\": true, \"properties\": {}},\n    {\"id\": \"clothes_bedroom_01\", \"name\": \"Scattered Clothes\", \"description\": \"Clothes scattered on the floor.\", \"is_interactive\": true, \"properties\": {}},\n    {\"id\": \"window_bedroom_01\", \"name\": \"Window\", \"description\": \"A window looking out onto the street.\", \"is_interactive\": true, \"properties\": {}}\n  ],\n  \"discovered_npcs\": []\n}\n```"}],"role":"model"}
{"parts":[{"text":"For context:"},{"text":"[SimulacraLLM_sim_3e912d] said: ```json\n{\"internal_monologue\": \"Okay, I've looked around and I'm in my bedroom. It's a bit messy, which is pretty typical for me, honestly. Unmade bed and clothes on the floor...yep, sounds about right. I hear traffic outside, so it must be morning or at least daytime. I should probably figure out what day it is and what my plans are for today. Do I have work? Any appointments? Since I don't immediately remember, maybe I should check my calendar. I think I keep it on my phone. I need to find my phone first, though. I vaguely remember leaving it on the kitchen counter last night. I'll go check there. I am feeling like I need to get my day on track.\", \"action_type\": \"move\", \"target_id\": null, \"details\": \"Moving to the kitchen to find my phone and check my calendar.\"}\n```"}],"role":"user"}
{"parts":[{"text":"For context:"},{"text":"[WorldEngineLLMAgent] said: ```json\n{\"valid_action\": true, \"duration\": 30.0, \"results\": {\"simulacra.sim_3e912d.location\": \"kitchen\"}, \"outcome_description\": \"Eleanor Hayes moved to the kitchen.\"}\n```"}],"role":"user"}
-----------------------------------------------------------
Functions:

-----------------------------------------------------------

2025-05-07 10:24:04,024 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:04,027 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:04,037 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F610D8D40>
2025-05-07 10:24:04,037 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF7F50> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:04,053 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6D6D4200>
2025-05-07 10:24:04,053 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:04,053 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:04,053 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:04,053 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:04,053 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:04,997 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:26 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=934'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:04,997 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:04,998 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:04,999 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:04,999 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:04,999 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:04,999 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
```json
{
  "narrative": "Eleanor shuffles out of her bedroom and into the kitchen, the linoleum cool beneath her bare feet. The faint aroma of stale coffee hangs in the air, a lingering reminder of yesterday's forgotten brew. Her eyes scan the cluttered countertop, searching for the familiar rectangle of her phone.",
  "discovered_objects": [],
  "discovered_npcs": []
}
```
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"```json\n{\n  \"narrative\": \"Eleanor shuffles out of her bedroom and into the kitchen, the linoleum cool beneath her bare feet. The faint aroma of stale coffee hangs in the air, a lingering reminder of yesterday's forgotten brew. Her eyes scan the cluttered countertop, searching for the familiar rectangle of her phone.\",\n  \"discovered_objects\": [],\n  \"discovered_npcs\": []\n}\n```"}],"role":"model"},"finish_reason":"STOP","avg_logprobs":-0.18439382917425606}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":89,"candidates_tokens_details":[{"modality":"TEXT","token_count":89}],"prompt_token_count":2402,"prompt_tokens_details":[{"modality":"TEXT","token_count":2402}],"total_token_count":2491},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:24:05,000 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "Eleanor shuffles out of her bedroom and into the kitchen, the linoleum coo...
2025-05-07 10:24:05,000 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:07,202 - src.simulation_async - INFO - [WorldInfoGatherer] Updating world feeds at sim_time 9.9 for location: Asheville, NC, United States
2025-05-07 10:24:07,202 - src.simulation_async - WARNING - Path segment 'world_feeds' not found or not dict in 'world_feeds.last_update_sim_time'. Creating.
2025-05-07 10:24:07,202 - src.simulation_async - INFO - [StateUpdate] Applied: world_feeds.last_update_sim_time = 9.905999999959022
2025-05-07 10:24:07,202 - src.simulation_async - INFO - [WorldInfoGatherer] Attempting REAL weather search for 'Asheville, NC, United States' with query: 'What is the current weather in Asheville, NC, United States?'
2025-05-07 10:24:07,211 - google.adk.models.google_llm - INFO - Sending out request, model: gemini-2.0-flash, backend: ml_dev, stream: False
2025-05-07 10:24:07,211 - google.adk.models.google_llm - INFO - 
LLM Request:
-----------------------------------------------------------
System Instruction:
I can answer your questions by searching the internet. Just ask me anything!

You are an agent. Your internal name is "SearchLLMAgent".

 The description about you is "Dedicated LLM Agent for performing Google Searches."
-----------------------------------------------------------
Contents:
{"parts":[{"text":"What is the current weather in Asheville, NC, United States?"}],"role":"user"}
-----------------------------------------------------------
Functions:

-----------------------------------------------------------

2025-05-07 10:24:07,211 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:07,213 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:07,234 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F081280>
2025-05-07 10:24:07,234 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F610495D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:07,251 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0828A0>
2025-05-07 10:24:07,251 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:07,251 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:07,251 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:07,251 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:07,251 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:09,436 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:31 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=2176'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:09,437 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:09,437 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:09,437 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:09,437 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:09,437 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:09,438 - google.adk.models.google_llm - INFO - 
LLM Response:
-----------------------------------------------------------
Text:
The current weather in Asheville, NC is cloudy with a temperature of 60F (16C). It feels like 60F (16C), and the humidity is around 64%. The chance of rain is 0%. The wind is blowing from the NNW at 8 mph. Visibility is 8 miles.

The forecast for this afternoon is mostly sunny with a high near 74F. Tonight will be partly cloudy with a low around 49F.
-----------------------------------------------------------
Function calls:

-----------------------------------------------------------
Raw response:
{"candidates":[{"content":{"parts":[{"text":"The current weather in Asheville, NC is cloudy with a temperature of 60F (16C). It feels like 60F (16C), and the humidity is around 64%. The chance of rain is 0%. The wind is blowing from the NNW at 8 mph. Visibility is 8 miles.\n\nThe forecast for this afternoon is mostly sunny with a high near 74F. Tonight will be partly cloudy with a low around 49F."}],"role":"model"},"finish_reason":"STOP","grounding_metadata":{"grounding_chunks":[{"web":{"title":"Weather information for locality: Asheville, administrative_area: NC","uri":"https://www.google.com/search?q=weather+in+Asheville,+NC"}},{"web":{"title":"iheart.com","uri":"https://vertexaisearch.cloud.google.com/grounding-api-redirect/AbF9wXGN5clGVcHvptyguZHf-6UqvnrvYhXM4yV9LM_Sjty1u38wKNpsjEQvJFNEGST5IxddcNSABeIa6lemqdQp22MGC_MYGE3ocr5mlah0GcyNYZT_oB9d8RpK5jI="}},{"web":{"title":"weather.gov","uri":"https://vertexaisearch.cloud.google.com/grounding-api-redirect/AbF9wXHnEnGLJ1H44IN-aD6JOLcXWR9fadJH4Lxbe6oXYUeOFHtCoKj_VvChcsd0wTWc-F2rvRSwhyd3k8_AO4zz8mfllrkmgXsGrQBZNedXlxMoL3xlBwpOAu18PkusgApHAOnl3qwjUH1HKcxpAIyKO2KUtsryEBzgq49nQFBnqg=="}}],"grounding_supports":[{"grounding_chunk_indices":[0],"segment":{"end_index":82,"text":"The current weather in Asheville, NC is cloudy with a temperature of 60F (16C)"}},{"grounding_chunk_indices":[0],"segment":{"end_index":143,"start_index":84,"text":"It feels like 60F (16C), and the humidity is around 64%"}},{"grounding_chunk_indices":[0],"segment":{"end_index":169,"start_index":145,"text":"The chance of rain is 0%"}},{"grounding_chunk_indices":[1],"segment":{"end_index":212,"start_index":171,"text":"The wind is blowing from the NNW at 8 mph"}},{"grounding_chunk_indices":[1],"segment":{"end_index":235,"start_index":214,"text":"Visibility is 8 miles"}},{"grounding_chunk_indices":[2],"segment":{"end_index":308,"start_index":238,"text":"The forecast for this afternoon is mostly sunny with a high near 74F"}},{"grounding_chunk_indices":[2],"segment":{"end_index":363,"start_index":310,"text":"Tonight will be partly cloudy with a low around 49F"}}],"retrieval_metadata":{},"search_entry_point":{"rendered_content":"<style>\n.container {\n  align-items: center;\n  border-radius: 8px;\n  display: flex;\n  font-family: Google Sans, Roboto, sans-serif;\n  font-size: 14px;\n  line-height: 20px;\n  padding: 8px 12px;\n}\n.chip {\n  display: inline-block;\n  border: solid 1px;\n  border-radius: 16px;\n  min-width: 14px;\n  padding: 5px 16px;\n  text-align: center;\n  user-select: none;\n  margin: 0 8px;\n  -webkit-tap-highlight-color: transparent;\n}\n.carousel {\n  overflow: auto;\n  scrollbar-width: none;\n  white-space: nowrap;\n  margin-right: -12px;\n}\n.headline {\n  display: flex;\n  margin-right: 4px;\n}\n.gradient-container {\n  position: relative;\n}\n.gradient {\n  position: absolute;\n  transform: translate(3px, -9px);\n  height: 36px;\n  width: 9px;\n}\n@media (prefers-color-scheme: light) {\n  .container {\n    background-color: #fafafa;\n    box-shadow: 0 0 0 1px #0000000f;\n  }\n  .headline-label {\n    color: #1f1f1f;\n  }\n  .chip {\n    background-color: #ffffff;\n    border-color: #d2d2d2;\n    color: #5e5e5e;\n    text-decoration: none;\n  }\n  .chip:hover {\n    background-color: #f2f2f2;\n  }\n  .chip:focus {\n    background-color: #f2f2f2;\n  }\n  .chip:active {\n    background-color: #d8d8d8;\n    border-color: #b6b6b6;\n  }\n  .logo-dark {\n    display: none;\n  }\n  .gradient {\n    background: linear-gradient(90deg, #fafafa 15%, #fafafa00 100%);\n  }\n}\n@media (prefers-color-scheme: dark) {\n  .container {\n    background-color: #1f1f1f;\n    box-shadow: 0 0 0 1px #ffffff26;\n  }\n  .headline-label {\n    color: #fff;\n  }\n  .chip {\n    background-color: #2c2c2c;\n    border-color: #3c4043;\n    color: #fff;\n    text-decoration: none;\n  }\n  .chip:hover {\n    background-color: #353536;\n  }\n  .chip:focus {\n    background-color: #353536;\n  }\n  .chip:active {\n    background-color: #464849;\n    border-color: #53575b;\n  }\n  .logo-light {\n    display: none;\n  }\n  .gradient {\n    background: linear-gradient(90deg, #1f1f1f 15%, #1f1f1f00 100%);\n  }\n}\n</style>\n<div class=\"container\">\n  <div class=\"headline\">\n    <svg class=\"logo-light\" width=\"18\" height=\"18\" viewBox=\"9 9 35 35\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M42.8622 27.0064C42.8622 25.7839 42.7525 24.6084 42.5487 23.4799H26.3109V30.1568H35.5897C35.1821 32.3041 33.9596 34.1222 32.1258 35.3448V39.6864H37.7213C40.9814 36.677 42.8622 32.2571 42.8622 27.0064V27.0064Z\" fill=\"#4285F4\"/>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M26.3109 43.8555C30.9659 43.8555 34.8687 42.3195 37.7213 39.6863L32.1258 35.3447C30.5898 36.3792 28.6306 37.0061 26.3109 37.0061C21.8282 37.0061 18.0195 33.9811 16.6559 29.906H10.9194V34.3573C13.7563 39.9841 19.5712 43.8555 26.3109 43.8555V43.8555Z\" fill=\"#34A853\"/>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M16.6559 29.8904C16.3111 28.8559 16.1074 27.7588 16.1074 26.6146C16.1074 25.4704 16.3111 24.3733 16.6559 23.3388V18.8875H10.9194C9.74388 21.2072 9.06992 23.8247 9.06992 26.6146C9.06992 29.4045 9.74388 32.022 10.9194 34.3417L15.3864 30.8621L16.6559 29.8904V29.8904Z\" fill=\"#FBBC05\"/>\n      <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M26.3109 16.2386C28.85 16.2386 31.107 17.1164 32.9095 18.8091L37.8466 13.8719C34.853 11.082 30.9659 9.3736 26.3109 9.3736C19.5712 9.3736 13.7563 13.245 10.9194 18.8875L16.6559 23.3388C18.0195 19.2636 21.8282 16.2386 26.3109 16.2386V16.2386Z\" fill=\"#EA4335\"/>\n    </svg>\n    <svg class=\"logo-dark\" width=\"18\" height=\"18\" viewBox=\"0 0 48 48\" xmlns=\"http://www.w3.org/2000/svg\">\n      <circle cx=\"24\" cy=\"23\" fill=\"#FFF\" r=\"22\"/>\n      <path d=\"M33.76 34.26c2.75-2.56 4.49-6.37 4.49-11.26 0-.89-.08-1.84-.29-3H24.01v5.99h8.03c-.4 2.02-1.5 3.56-3.07 4.56v.75l3.91 2.97h.88z\" fill=\"#4285F4\"/>\n      <path d=\"M15.58 25.77A8.845 8.845 0 0 0 24 31.86c1.92 0 3.62-.46 4.97-1.31l4.79 3.71C31.14 36.7 27.65 38 24 38c-5.93 0-11.01-3.4-13.45-8.36l.17-1.01 4.06-2.85h.8z\" fill=\"#34A853\"/>\n      <path d=\"M15.59 20.21a8.864 8.864 0 0 0 0 5.58l-5.03 3.86c-.98-2-1.53-4.25-1.53-6.64 0-2.39.55-4.64 1.53-6.64l1-.22 3.81 2.98.22 1.08z\" fill=\"#FBBC05\"/>\n      <path d=\"M24 14.14c2.11 0 4.02.75 5.52 1.98l4.36-4.36C31.22 9.43 27.81 8 24 8c-5.93 0-11.01 3.4-13.45 8.36l5.03 3.85A8.86 8.86 0 0 1 24 14.14z\" fill=\"#EA4335\"/>\n    </svg>\n    <div class=\"gradient-container\"><div class=\"gradient\"></div></div>\n  </div>\n  <div class=\"carousel\">\n    <a class=\"chip\" href=\"https://vertexaisearch.cloud.google.com/grounding-api-redirect/AbF9wXGokJAkp0G-LOOacp15nKmLU8vDGnSEOiCPiTr1eBlcIT_X4TFzFHs8uXUMMK7UU-1GJLJ7RBcl8UCmLiNzhamJ1m3ZOIMqwY9st_F0sZeKKVMdoL6K0wfJWAALW55kwIZi7xmHEVX3-9WbM47aEjxvlMo4VZEIBrRU3tP7SFeZIDVLjeL08R4W7KQ1QYfsN8SRDxJn88r-2_IRFwbsDSyIUe4=\">current weather in Asheville, NC</a>\n  </div>\n</div>\n"},"web_search_queries":["current weather in Asheville, NC"]}}],"model_version":"gemini-2.0-flash","usage_metadata":{"candidates_token_count":108,"candidates_tokens_details":[{"modality":"TEXT","token_count":108}],"prompt_token_count":60,"prompt_tokens_details":[{"modality":"TEXT","token_count":60}],"total_token_count":168},"automatic_function_calling_history":[]}
-----------------------------------------------------------

2025-05-07 10:24:09,438 - src.simulation_async - DEBUG - [WorldInfoGatherer_SearchEvent_Weather] Event ID: TWVI9q40, Author: SearchLLMAgent
2025-05-07 10:24:09,438 - src.simulation_async - INFO - [WorldInfoGatherer_SearchEvent_Weather] Text response: The current weather in Asheville, NC is cloudy with a temperature of 60F (16C). It feels like 60F (16C), and the humidity is around 64%. The chance of rain is 0%. The wind is blowing from the NNW ...
2025-05-07 10:24:09,438 - src.simulation_async - INFO - [WorldInfoGatherer] REAL weather search returned: The current weather in Asheville, NC is cloudy with a temperature of 60F (16C). It feels like 60F (16C), and the humidity is around 64%. The chance of rain is 0%. The wind is blowing from the NNW at 8 mph. Visibility is 8 miles.

The forecast for this afternoon is mostly sunny with a high near 74F. Tonight will be partly cloudy with a low around 49F.
2025-05-07 10:24:09,441 - grpc._cython.cygrpc - DEBUG - Using AsyncIOEngine.POLLER as I/O engine
2025-05-07 10:24:10,037 - src.simulation_async - INFO - [StateUpdate] Applied: world_feeds.weather = {'condition': 'cloudy', 'temperature_celsius': 16, 'forecast_short': 'Mostly sunny this afternoon, partly cloudy tonight.', 'timestamp': 9.905999999959022, 'source_category': 'weather'}
2025-05-07 10:24:10,037 - src.simulation_async - INFO - [WorldInfoGatherer] Attempting REAL search for 'world_news' with query: 'What are the latest top world news headlines (e.g., politics, social issues, environment, major international events)?'
2025-05-07 10:24:10,045 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:10,047 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:10,060 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0457C0>
2025-05-07 10:24:10,060 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6108F4D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:10,079 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F044C50>
2025-05-07 10:24:10,079 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:10,079 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:10,079 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:10,080 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:10,080 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:13,500 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:35 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=3412'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:13,501 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:13,501 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:13,501 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:13,502 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:13,502 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:13,503 - src.simulation_async - DEBUG - [WorldInfoGatherer_SearchEvent_world_news] Event ID: nz1yckf6, Author: SearchLLMAgent
2025-05-07 10:24:13,503 - src.simulation_async - INFO - [WorldInfoGatherer_SearchEvent_world_news] Text response: Here are some of the latest top world news headlines:

*   **Politics:** Romania's hard-right candidate, George Simion, will face a pro-EU reformist in a presidential runoff election. Senior cardinals...
2025-05-07 10:24:13,503 - src.simulation_async - INFO - [WorldInfoGatherer] Search for 'world_news' returned: Here are some of the latest top world news headlines:

*   **Politics:** Romania's hard-right candidate, George Simion, will face a pro-EU reformist in a presidential runoff election. Senior cardinals are urging conclave voters to pick a pope who seeks unity.
*   **Social Issues:** Almost 1 billion people globally have some form of mental disorder, which has been worsened by the pandemic.
*   **Environment:** A study shows that the world's wealthiest 10% have contributed to two-thirds of global 
2025-05-07 10:24:14,243 - src.simulation_async - INFO - [StateUpdate] Applied: world_feeds.news_updates = [{'headline': 'Global Issues Dominate World News', 'summary': 'World news includes Romanian election, mental health crisis, climate change impact, Gaza conflict, Ukrainian drone strikes, and global carbon pricing.', 'timestamp': 9.905999999959022, 'source_category': 'world_news'}]
2025-05-07 10:24:14,248 - src.simulation_async - INFO - [WorldInfoGatherer] Attempting REAL search for 'regional_news' with query: 'What are the latest top national news headlines for United States?'
2025-05-07 10:24:14,256 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:14,259 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:14,276 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6DAFAF30>
2025-05-07 10:24:14,277 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F08BD50> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:14,295 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6DAFB200>
2025-05-07 10:24:14,295 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:14,296 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:14,296 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:14,296 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:14,296 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:17,582 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:39 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=3273'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:17,582 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:17,582 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:17,583 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:17,583 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:17,583 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:17,584 - src.simulation_async - DEBUG - [WorldInfoGatherer_SearchEvent_regional_news] Event ID: qRiRuEiK, Author: SearchLLMAgent
2025-05-07 10:24:17,584 - src.simulation_async - INFO - [WorldInfoGatherer_SearchEvent_regional_news] Text response: Here are some of the latest top national news headlines for the United States:

*   **Politics:** There is pressure to pass the Gulf of America bill, which is rubbing some GOP lawmakers the wrong way....
2025-05-07 10:24:17,584 - src.simulation_async - INFO - [WorldInfoGatherer] Search for 'regional_news' returned: Here are some of the latest top national news headlines for the United States:

*   **Politics:** There is pressure to pass the Gulf of America bill, which is rubbing some GOP lawmakers the wrong way.
*   **U.S. REAL ID Deadline:** The deadline is here, and you might face extra screening if you try to fly without one.
*   **Trump:** Trump is planning to announce that the U.S. will call the Persian Gulf the Arabian Gulf, officials say. He is also teasing a big announcement ahead of his Mideast tr
2025-05-07 10:24:18,407 - src.simulation_async - INFO - [StateUpdate] Applied: world_feeds.news_updates = [{'headline': "US National News: REAL ID Deadline, Gulf Debate, and Trump's Plans", 'summary': 'The U.S. faces REAL ID enforcement, political friction over the Gulf of America bill, and potential changes to the name of the Persian Gulf by Trump.', 'timestamp': 9.905999999959022, 'source_category': 'regional_news'}, {'headline': 'Global Issues Dominate World News', 'summary': 'World news includes Romanian election, mental health crisis, climate change impact, Gaza conflict, Ukrainian drone strikes, and global carbon pricing.', 'timestamp': 9.905999999959022, 'source_category': 'world_news'}]
2025-05-07 10:24:18,408 - src.simulation_async - INFO - [WorldInfoGatherer] Attempting REAL search for 'local_news' with query: 'What are the top latest local news headlines for Asheville, NC?'
2025-05-07 10:24:18,416 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:18,419 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:18,432 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F00B020>
2025-05-07 10:24:18,432 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF6050> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:18,451 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F610D8B00>
2025-05-07 10:24:18,452 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:18,452 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:18,452 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:18,452 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:18,452 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:21,708 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:43 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=3243'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:21,708 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:21,708 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:21,709 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:21,709 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:21,709 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:21,710 - src.simulation_async - DEBUG - [WorldInfoGatherer_SearchEvent_local_news] Event ID: kqePj5ZY, Author: SearchLLMAgent
2025-05-07 10:24:21,710 - src.simulation_async - INFO - [WorldInfoGatherer_SearchEvent_local_news] Text response: Here are some of the latest top local news headlines for Asheville, NC:

*   **Local Government:** Buncombe County is inching closer to a property tax hike.
*   **Hurricane Helene Recovery:** Madison ...
2025-05-07 10:24:21,710 - src.simulation_async - INFO - [WorldInfoGatherer] Search for 'local_news' returned: Here are some of the latest top local news headlines for Asheville, NC:

*   **Local Government:** Buncombe County is inching closer to a property tax hike.
*   **Hurricane Helene Recovery:** Madison County organizations have received grants to support recovery efforts from Hurricane Helene. A food drive is also underway to support MANNA FoodBank's Helene recovery efforts. The City of Asheville is beginning the process to rebuild the storm-damaged French Broad Riverfront Parks System. North Bunc
2025-05-07 10:24:22,442 - src.simulation_async - INFO - [StateUpdate] Applied: world_feeds.news_updates = [{'headline': 'Asheville News: Tax Hike, Helene Recovery, Crime, and Airport Expansion', 'summary': 'Asheville grapples with a potential property tax increase, ongoing Hurricane Helene recovery efforts, recent drug and gun-related arrests, and developments at the regional airport.', 'timestamp': 9.905999999959022, 'source_category': 'local_news'}, {'headline': "US National News: REAL ID Deadline, Gulf Debate, and Trump's Plans", 'summary': 'The U.S. faces REAL ID enforcement, political friction over the Gulf of America bill, and potential changes to the name of the Persian Gulf by Trump.', 'timestamp': 9.905999999959022, 'source_category': 'regional_news'}, {'headline': 'Global Issues Dominate World News', 'summary': 'World news includes Romanian election, mental health crisis, climate change impact, Gaza conflict, Ukrainian drone strikes, and global carbon pricing.', 'timestamp': 9.905999999959022, 'source_category': 'world_news'}]
2025-05-07 10:24:22,442 - src.simulation_async - INFO - [WorldInfoGatherer] Attempting REAL search for 'pop_culture' with query: 'What are the top latest United States  pop culture trends and entertainment news headlines (e.g., movies, music, viral trends)?'
2025-05-07 10:24:22,450 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:22,454 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:22,464 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6D9E67B0>
2025-05-07 10:24:22,464 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F0DD850> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:22,483 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F60B60E90>
2025-05-07 10:24:22,483 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:22,483 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:22,483 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:22,483 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:22,483 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:26,109 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:47 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=3615'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:26,109 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:26,109 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:26,109 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:26,109 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:26,110 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:26,111 - src.simulation_async - DEBUG - [WorldInfoGatherer_SearchEvent_pop_culture] Event ID: m3Yh2LPm, Author: SearchLLMAgent
2025-05-07 10:24:26,111 - src.simulation_async - INFO - [WorldInfoGatherer_SearchEvent_pop_culture] Text response: Here are some of the latest pop culture and entertainment headlines in the United States:

*   **Music:** Katy Perry says her new sci-fi-inspired world tour is Disneyland on wheels. Usher's new conc...
2025-05-07 10:24:26,111 - src.simulation_async - INFO - [WorldInfoGatherer] Search for 'pop_culture' returned: Here are some of the latest pop culture and entertainment headlines in the United States:

*   **Music:** Katy Perry says her new sci-fi-inspired world tour is Disneyland on wheels. Usher's new concert film &#39;Usher: Rendezvous in Paris&#39; is playing in theaters through Sunday. Ed Sheeran is dialing back in with his new song Old Phone ringing in a new Era.
*   **Television:** "SNL" host Quinta Brunson is teaching a comedy master class. There's a trailer out for 'NCIS: Tony & Ziva'.
*   *
2025-05-07 10:24:26,887 - src.simulation_async - INFO - [StateUpdate] Applied: world_feeds.pop_culture_updates = [{'headline': 'Pop Culture Buzz: Music, TV, Movies, and Celeb News', 'summary': "Katy Perry's tour is 'Disneyland on wheels', 'NCIS' gets a trailer, Affleck defends filming in LA, and celeb relationships heat up.", 'timestamp': 9.905999999959022, 'source_category': 'pop_culture'}]
2025-05-07 10:24:26,887 - src.simulation_async - INFO - [WorldInfoGatherer] World feeds updated. Next check in 3600.0 sim_seconds.
2025-05-07 10:24:33,247 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 36.1 (due at 36.0).
2025-05-07 10:24:33,247 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.location = kitchen
2025-05-07 10:24:33,247 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:33,247 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:33,247 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:33,495 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:33,495 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:33,516 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:33,519 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:33,533 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE1B0>
2025-05-07 10:24:33,533 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF56D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:33,551 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE240>
2025-05-07 10:24:33,551 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:33,551 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:33,551 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:33,551 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:33,551 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:34,951 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:56 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1390'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:34,951 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:34,951 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:34,951 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:34,951 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:34,951 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:34,967 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:34,967 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (look_around on N/A) classified as 'environment'.
2025-05-07 10:24:34,967 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'look_around', 'target_id': None, 'details': 'Looking around the kitchen, specifically on the counter, for my phone.'}
2025-05-07 10:24:34,967 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (look_around).
2025-05-07 10:24:34,993 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:34,997 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:35,009 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE570>
2025-05-07 10:24:35,009 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F455750> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:35,028 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6D1BD0A0>
2025-05-07 10:24:35,028 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:35,029 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:35,029 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:35,029 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:35,029 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:36,051 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:57 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1015'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:36,051 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:36,052 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:36,052 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:36,052 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:36,052 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:36,053 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 2.0, "results": {"simulacra.sim_3e912d.last_observation":...
2025-05-07 10:24:36,053 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:36,063 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:36,063 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {'simulacra.sim_3e912d.last_observation': 'The kitchen counter is cluttered with mail, a dirty coffee mug, and various odds and ends. Half-hidden beneath a stack of envelopes, you spot your phone.'}
2025-05-07 10:24:36,063 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 39.68799999996554
2025-05-07 10:24:36,063 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: look_around - Details: Looking around the kitchen, specifically on the counter, for my phone.
2025-05-07 10:24:36,063 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 39.7s. Outcome: Eleanor Hayes looked around the kitchen.
2025-05-07 10:24:36,063 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:36,063 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes looked around the kitchen.'
2025-05-07 10:24:36,088 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:36,090 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:36,116 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE1E0>
2025-05-07 10:24:36,116 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF56D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:36,135 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE240>
2025-05-07 10:24:36,136 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:36,136 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:36,136 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:36,137 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:36,137 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:36,890 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 39.7 (due at 39.7).
2025-05-07 10:24:36,890 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.last_observation = The kitchen counter is cluttered with mail, a dirty coffee mug, and various odds and ends. Half-hidden beneath a stack of envelopes, you spot your phone.
2025-05-07 10:24:36,890 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:36,890 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:36,890 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:36,968 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:36,968 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:36,982 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:36,986 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:37,001 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48C140>
2025-05-07 10:24:37,001 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F456F50> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:37,020 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48E3C0>
2025-05-07 10:24:37,020 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:37,020 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:37,020 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:37,020 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:37,020 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:37,983 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:59 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1834'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:37,983 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:37,983 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:37,984 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:37,984 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:37,984 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:37,984 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "Eleanor surveys the kitchen counter, a chaotic landscape of unopened **mai...
2025-05-07 10:24:37,985 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:38,127 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:24:59 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1098'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:38,127 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:38,127 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:38,128 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:38,129 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:38,129 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:38,148 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:38,148 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (use on phone_kitchen_01) classified as 'environment'.
2025-05-07 10:24:38,148 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'use', 'target_id': 'phone_kitchen_01', 'details': 'Grabbing my phone from the kitchen counter.'}
2025-05-07 10:24:38,148 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (use).
2025-05-07 10:24:38,169 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:38,172 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:38,184 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AFDA0>
2025-05-07 10:24:38,184 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F038B50> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:38,206 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6D1BD0A0>
2025-05-07 10:24:38,206 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:38,206 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:38,206 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:38,207 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:38,207 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:38,878 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:00 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=661'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:38,878 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:38,878 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:38,878 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:38,879 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:38,879 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:38,879 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 2.0, "results": {}, "outcome_description": "Eleanor Hayes...
2025-05-07 10:24:38,880 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:38,893 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:38,896 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:38,896 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 42.93799999996554
2025-05-07 10:24:38,896 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: use - Details: Grabbing my phone from the kitchen counter.
2025-05-07 10:24:38,896 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 42.9s. Outcome: Eleanor Hayes grabbed the phone.
2025-05-07 10:24:38,896 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:38,896 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes grabbed the phone.'
2025-05-07 10:24:38,917 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:38,921 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:38,954 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F046450>
2025-05-07 10:24:38,954 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF76D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:38,973 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48F320>
2025-05-07 10:24:38,974 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:38,974 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:38,974 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:38,974 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:38,974 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:39,913 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:01 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=928'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:39,913 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:39,914 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:39,914 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:39,914 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:39,914 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:39,915 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "Eleanor snatches her phone from its paper tomb, a small surge of triumph w...
2025-05-07 10:24:39,915 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:40,131 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 42.9 (due at 42.9).
2025-05-07 10:24:40,131 - src.simulation_async - DEBUG - [TimeManager] No pending results found for completed action of sim_3e912d.
2025-05-07 10:24:40,131 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:40,131 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:40,178 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:40,178 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:40,199 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:40,202 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:40,212 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48C320>
2025-05-07 10:24:40,213 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF7550> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:40,232 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48EB70>
2025-05-07 10:24:40,232 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:40,233 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:40,233 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:40,233 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:40,233 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:41,416 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:03 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1171'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:41,416 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:41,416 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:41,417 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:41,417 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:41,418 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:41,438 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:41,438 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (use on phone_kitchen_01) classified as 'environment'.
2025-05-07 10:24:41,438 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'use', 'target_id': 'phone_kitchen_01', 'details': 'Unlocking my phone and opening the calendar app.'}
2025-05-07 10:24:41,438 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (use).
2025-05-07 10:24:41,459 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:41,464 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:41,480 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48F230>
2025-05-07 10:24:41,480 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF6AD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:41,502 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6DBBAC30>
2025-05-07 10:24:41,502 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:41,503 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:41,503 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:41,503 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:41,503 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:42,142 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:04 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=627'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:42,142 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:42,142 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:42,143 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:42,143 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:42,143 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:42,144 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 5.0, "results": {}, "outcome_description": "Eleanor Hayes...
2025-05-07 10:24:42,144 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:42,158 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:42,158 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:42,158 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 49.23499999998603
2025-05-07 10:24:42,158 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: use - Details: Unlocking my phone and opening the calendar app.
2025-05-07 10:24:42,158 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 49.2s. Outcome: Eleanor Hayes unlocked the phone and opened the calendar app.
2025-05-07 10:24:42,158 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:42,158 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes unlocked the phone and opened the calendar app.'
2025-05-07 10:24:42,180 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:42,184 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:42,196 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48FE30>
2025-05-07 10:24:42,196 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F03B750> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:42,212 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48E180>
2025-05-07 10:24:42,212 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:42,213 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:42,213 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:42,213 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:42,213 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:43,230 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:05 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1008'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:43,231 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:43,231 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:43,231 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:43,231 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:43,231 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:43,232 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "Eleanor's thumb finds the power button, and the phone screen flickers to l...
2025-05-07 10:24:43,236 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:46,517 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 49.3 (due at 49.2).
2025-05-07 10:24:46,517 - src.simulation_async - DEBUG - [TimeManager] No pending results found for completed action of sim_3e912d.
2025-05-07 10:24:46,517 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:46,517 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:46,997 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:46,997 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:47,017 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:47,021 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:47,033 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0827E0>
2025-05-07 10:24:47,033 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F610497D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:47,051 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0ACCB0>
2025-05-07 10:24:47,051 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:47,052 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:47,052 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:47,052 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:47,052 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:48,531 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:10 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1471'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:48,532 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:48,532 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:48,533 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:48,533 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:48,533 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:48,549 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:48,552 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (think on N/A) classified as 'environment'.
2025-05-07 10:24:48,552 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'think', 'target_id': None, 'details': "Thinking about the day's schedule and planning to get ready for work."}
2025-05-07 10:24:48,552 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (think).
2025-05-07 10:24:48,571 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:48,575 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:48,589 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AD0D0>
2025-05-07 10:24:48,589 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F455850> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:48,607 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AF3B0>
2025-05-07 10:24:48,608 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:48,608 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:48,608 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:48,608 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:48,608 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:49,773 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:11 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1155'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:49,774 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:49,774 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:49,774 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:49,774 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:49,774 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:49,775 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 3.0, "results": {"simulacra.sim_3e912d.status": "idle", "...
2025-05-07 10:24:49,775 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:49,785 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:49,785 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {'simulacra.sim_3e912d.status': 'idle', 'current_action_end_time': 1697461448.0, 'simulacra.sim_3e912d.last_observation': 'You have a dentist appointment at 2 pm today and need to pick up groceries after work.'}
2025-05-07 10:24:49,785 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 54.32799999997951
2025-05-07 10:24:49,785 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: think - Details: Thinking about the day's schedule and planning to get ready for work.
2025-05-07 10:24:49,785 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 54.3s. Outcome: Eleanor Hayes thought about the day's schedule.
2025-05-07 10:24:49,785 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:49,785 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes thought about the day's schedule.'
2025-05-07 10:24:49,806 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:49,811 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:49,824 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE840>
2025-05-07 10:24:49,824 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F5D7ED3D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:49,842 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AEC90>
2025-05-07 10:24:49,842 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:49,842 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:49,842 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:49,842 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:49,842 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:50,962 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:12 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1106'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:50,963 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:50,963 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:50,963 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:50,963 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:50,963 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:50,964 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "The reality of Tuesday, October 15th settles in. Eleanor breathes a small ...
2025-05-07 10:24:50,964 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 54.4 (due at 54.3).
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [StateUpdate] Applied: current_action_end_time = 1697461448.0
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.last_observation = You have a dentist appointment at 2 pm today and need to pick up groceries after work.
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:51,603 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:51,634 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:51,634 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:51,655 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:51,660 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:51,674 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F4C5400>
2025-05-07 10:24:51,674 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F457350> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:51,693 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F083410>
2025-05-07 10:24:51,693 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:51,693 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:51,693 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:51,693 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:51,693 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:52,961 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:14 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1256'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:52,962 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:52,962 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:52,962 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:52,962 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:52,963 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:52,978 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:52,978 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (initiate_change on N/A) classified as 'environment'.
2025-05-07 10:24:52,978 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'initiate_change', 'target_id': None, 'details': 'Deciding to make coffee before getting ready for work.'}
2025-05-07 10:24:52,978 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (initiate_change).
2025-05-07 10:24:53,002 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:53,007 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:53,018 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F610D8D70>
2025-05-07 10:24:53,018 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F03BBD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:53,036 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0827E0>
2025-05-07 10:24:53,037 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:53,037 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:53,037 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:53,037 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:53,037 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:54,059 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:15 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1014'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:54,060 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:54,060 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:54,061 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:54,061 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:54,061 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:54,062 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 2.0, "results": {"simulacra.sim_3e912d.status": "idle", "...
2025-05-07 10:24:54,062 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:54,073 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:54,073 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {'simulacra.sim_3e912d.status': 'idle', 'current_action_end_time': 1697461450.0, 'simulacra.sim_3e912d.last_observation': 'You decide to make coffee before getting ready for work.'}
2025-05-07 10:24:54,073 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 57.68799999996554
2025-05-07 10:24:54,073 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: initiate_change - Details: Deciding to make coffee before getting ready for work.
2025-05-07 10:24:54,073 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 57.7s. Outcome: Eleanor Hayes decided to make coffee.
2025-05-07 10:24:54,073 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:54,073 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes decided to make coffee.'
2025-05-07 10:24:54,100 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:54,104 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:54,129 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AF5F0>
2025-05-07 10:24:54,129 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F0DE6D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:54,146 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE9F0>
2025-05-07 10:24:54,146 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:54,147 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:54,147 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:54,147 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:54,147 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 57.7 (due at 57.7).
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [StateUpdate] Applied: current_action_end_time = 1697461450.0
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.last_observation = You decide to make coffee before getting ready for work.
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:24:54,920 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:24:54,998 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:24:54,998 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:24:55,013 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:55,018 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:55,044 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F4C7290>
2025-05-07 10:24:55,045 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF7250> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:55,065 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6D9E67B0>
2025-05-07 10:24:55,065 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:55,065 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:55,065 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:55,065 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:55,066 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:55,090 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:16 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=934'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:55,090 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:55,090 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:55,091 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:55,091 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:55,091 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:55,091 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "The thought of facing the day without caffeine is simply unbearable. Elean...
2025-05-07 10:24:55,092 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:24:55,967 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:17 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=894'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:55,967 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:55,967 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:55,967 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:55,967 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:55,968 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:55,984 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:24:55,984 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (use on N/A) classified as 'environment'.
2025-05-07 10:24:55,984 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'use', 'target_id': None, 'details': 'Making coffee using the coffee maker.'}
2025-05-07 10:24:55,984 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (use).
2025-05-07 10:24:56,005 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:56,011 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:56,021 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AD160>
2025-05-07 10:24:56,021 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF6FD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:56,041 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AF440>
2025-05-07 10:24:56,041 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:56,042 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:56,042 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:56,042 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:56,042 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:56,780 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:18 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=726'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:56,780 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:56,780 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:56,780 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:56,780 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:56,780 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:56,781 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 30.0, "results": {}, "outcome_description": "Eleanor Haye...
2025-05-07 10:24:56,781 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:24:56,791 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:24:56,791 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:24:56,791 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 88.78099999995902
2025-05-07 10:24:56,791 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: use - Details: Making coffee using the coffee maker.
2025-05-07 10:24:56,791 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 88.8s. Outcome: Eleanor Hayes started making coffee.
2025-05-07 10:24:56,791 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:24:56,791 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes started making coffee.'
2025-05-07 10:24:56,817 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:24:56,822 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:24:56,833 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AEC90>
2025-05-07 10:24:56,833 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF4CD0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:24:56,852 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AC650>
2025-05-07 10:24:56,852 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:24:56,853 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:24:56,853 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:24:56,853 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:24:56,853 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:24:57,872 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:19 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1010'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:24:57,872 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:24:57,872 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:24:57,872 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:24:57,872 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:24:57,872 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:24:57,873 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "Eleanor fills the coffee maker with water, scoops in the grounds, and pres...
2025-05-07 10:24:57,873 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:25:26,008 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 88.8 (due at 88.8).
2025-05-07 10:25:26,008 - src.simulation_async - DEBUG - [TimeManager] No pending results found for completed action of sim_3e912d.
2025-05-07 10:25:26,008 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:25:26,008 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:25:26,520 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:25:26,520 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:25:26,541 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:25:26,547 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:25:26,559 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F083530>
2025-05-07 10:25:26,559 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F038550> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:25:26,578 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0801A0>
2025-05-07 10:25:26,578 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:25:26,578 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:25:26,578 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:25:26,578 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:25:26,578 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:25:28,061 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:49 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1475'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:25:28,062 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:25:28,062 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:25:28,062 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:25:28,062 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:25:28,063 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:25:28,079 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:25:28,079 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (use on mug_kitchen_01) classified as 'environment'.
2025-05-07 10:25:28,079 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'use', 'target_id': 'mug_kitchen_01', 'details': 'Rinsing out the dirty coffee mug in the sink.'}
2025-05-07 10:25:28,079 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (use).
2025-05-07 10:25:28,102 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:25:28,107 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:25:28,119 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F046540>
2025-05-07 10:25:28,119 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6EFF56D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:25:28,137 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F00B8F0>
2025-05-07 10:25:28,137 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:25:28,137 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:25:28,137 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:25:28,138 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:25:28,138 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:25:28,822 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:50 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=674'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:25:28,822 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:25:28,822 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:25:28,823 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:25:28,823 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:25:28,823 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:25:28,823 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 15.0, "results": {}, "outcome_description": "Eleanor Haye...
2025-05-07 10:25:28,824 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:25:28,833 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:25:28,833 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:25:28,833 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 105.875
2025-05-07 10:25:28,833 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: use - Details: Rinsing out the dirty coffee mug in the sink.
2025-05-07 10:25:28,833 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 105.9s. Outcome: Eleanor Hayes rinsed out the dirty coffee mug.
2025-05-07 10:25:28,834 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:25:28,834 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes rinsed out the dirty coffee mug.'
2025-05-07 10:25:28,856 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:25:28,861 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:25:28,871 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F083710>
2025-05-07 10:25:28,871 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF5C50> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:25:28,892 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F045550>
2025-05-07 10:25:28,892 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:25:28,892 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:25:28,892 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:25:28,892 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:25:28,893 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:25:29,814 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:25:51 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=910'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:25:29,814 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:25:29,814 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:25:29,814 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:25:29,814 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:25:29,814 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:25:29,815 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "While the coffee gurgles its way to completion, Eleanor grabs the offendin...
2025-05-07 10:25:29,815 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:25:43,146 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 106.0 (due at 105.9).
2025-05-07 10:25:43,146 - src.simulation_async - DEBUG - [TimeManager] No pending results found for completed action of sim_3e912d.
2025-05-07 10:25:43,146 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:25:43,146 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:25:43,654 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:25:43,654 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:25:43,675 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:25:43,680 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:25:43,694 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0812E0>
2025-05-07 10:25:43,694 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F088050> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:25:43,711 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F00BB30>
2025-05-07 10:25:43,711 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:25:43,712 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:25:43,712 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:25:43,712 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:25:43,712 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:25:44,892 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:26:06 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=1174'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:25:44,892 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:25:44,892 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:25:44,892 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:25:44,893 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:25:44,893 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:25:44,908 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = thinking
2025-05-07 10:25:44,908 - src.simulation_async - INFO - [InteractionDispatcher] Intent from sim_3e912d (wait on N/A) classified as 'environment'.
2025-05-07 10:25:44,908 - src.simulation_async - INFO - [WorldEngineLLM] Received 'environment' action request from sim_3e912d: {'action_type': 'wait', 'target_id': None, 'details': 'Waiting for the coffee to finish brewing.'}
2025-05-07 10:25:44,909 - src.simulation_async - DEBUG - [WorldEngineLLM] Sending prompt to LLM for sim_3e912d's intent (wait).
2025-05-07 10:25:44,929 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:25:44,935 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:25:44,946 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F48CB00>
2025-05-07 10:25:44,946 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6DAF60D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:25:44,965 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F0AE6F0>
2025-05-07 10:25:44,965 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:25:44,965 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:25:44,965 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:25:44,965 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:25:44,965 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:25:45,720 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:26:07 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=745'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:25:45,721 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:25:45,721 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:25:45,721 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:25:45,721 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:25:45,721 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:25:45,722 - src.simulation_async - DEBUG - WorldLLM Final Content: ```json
{"valid_action": true, "duration": 20.0, "results": {}, "outcome_description": "Eleanor Haye...
2025-05-07 10:25:45,722 - src.simulation_async - DEBUG - [WorldEngineLLM] LLM response validated successfully for sim_3e912d.
2025-05-07 10:25:45,732 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = busy
2025-05-07 10:25:45,732 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.pending_results = {}
2025-05-07 10:25:45,732 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_end_time = 127.68799999996554
2025-05-07 10:25:45,732 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.current_action_description = Action: wait - Details: Waiting for the coffee to finish brewing.
2025-05-07 10:25:45,732 - src.simulation_async - INFO - [WorldEngineLLM] Action VALID for sim_3e912d. Stored results, set end time 127.7s. Outcome: Eleanor Hayes waited for the coffee to finish brewing.
2025-05-07 10:25:45,732 - src.simulation_async - DEBUG - [NarrationTask] Using global world mood: 'The familiar, everyday real world; starting the morning routine at home.'
2025-05-07 10:25:45,732 - src.simulation_async - INFO - [NarrationTask] Generating narrative for Eleanor Hayes's action completion. Outcome: 'Eleanor Hayes waited for the coffee to finish brewing.'
2025-05-07 10:25:45,758 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:25:45,764 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:25:45,794 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F083710>
2025-05-07 10:25:45,794 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F039ED0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:25:45,812 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F081C10>
2025-05-07 10:25:45,812 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:25:45,812 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:25:45,812 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:25:45,813 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:25:45,813 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:25:46,783 - httpcore.http11 - DEBUG - receive_response_headers.complete return_value=(b'HTTP/1.1', 200, b'OK', [(b'Content-Type', b'application/json; charset=UTF-8'), (b'Vary', b'Origin'), (b'Vary', b'X-Origin'), (b'Vary', b'Referer'), (b'Content-Encoding', b'gzip'), (b'Date', b'Wed, 07 May 2025 14:26:08 GMT'), (b'Server', b'scaffolding on HTTPServer2'), (b'X-XSS-Protection', b'0'), (b'X-Frame-Options', b'SAMEORIGIN'), (b'X-Content-Type-Options', b'nosniff'), (b'Server-Timing', b'gfet4t7; dur=958'), (b'Alt-Svc', b'h3=":443"; ma=2592000,h3-29=":443"; ma=2592000'), (b'Transfer-Encoding', b'chunked')])
2025-05-07 10:25:46,784 - httpx - INFO - HTTP Request: POST https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent "HTTP/1.1 200 OK"
2025-05-07 10:25:46,784 - httpcore.http11 - DEBUG - receive_response_body.started request=<Request [b'POST']>
2025-05-07 10:25:46,785 - httpcore.http11 - DEBUG - receive_response_body.complete
2025-05-07 10:25:46,785 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:25:46,785 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:25:46,786 - src.simulation_async - DEBUG - NarrationLLM Final Content: ```json
{
  "narrative": "The coffee maker sputters its final, satisfying gurgles. The rich aroma fi...
2025-05-07 10:25:46,786 - src.simulation_async - ERROR - [NarrationTask] Error processing event: 'str' object has no attribute 'get'
Traceback (most recent call last):
  File "C:\Users\dshea\Desktop\TheSimulation\src\simulation_async.py", line 162, in narration_task
    actual_narrative_paragraph = narrator_output.get("narrative", "An event occurred.")
                                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'str' object has no attribute 'get'
2025-05-07 10:26:04,928 - src.simulation_async - INFO - [TimeManager] Applying completed action effects for sim_3e912d at time 127.7 (due at 127.7).
2025-05-07 10:26:04,928 - src.simulation_async - DEBUG - [TimeManager] No pending results found for completed action of sim_3e912d.
2025-05-07 10:26:04,928 - src.simulation_async - INFO - [StateUpdate] Applied: simulacra.sim_3e912d.status = idle
2025-05-07 10:26:04,928 - src.simulation_async - INFO - [TimeManager] Set sim_3e912d status to idle.
2025-05-07 10:26:05,098 - src.simulation_async - DEBUG - [Eleanor Hayes] Status is idle. Proceeding to plan next action.
2025-05-07 10:26:05,098 - src.simulation_async - DEBUG - [Eleanor Hayes] Sending subsequent prompt.
2025-05-07 10:26:05,119 - google_genai.models - INFO - AFC is enabled with max remote calls: 10.
2025-05-07 10:26:05,126 - httpcore.connection - DEBUG - connect_tcp.started host='generativelanguage.googleapis.com' port=443 local_address=None timeout=None socket_options=None
2025-05-07 10:26:05,142 - httpcore.connection - DEBUG - connect_tcp.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F4C56D0>
2025-05-07 10:26:05,142 - httpcore.connection - DEBUG - start_tls.started ssl_context=<ssl.SSLContext object at 0x0000021F6F4770D0> server_hostname='generativelanguage.googleapis.com' timeout=None
2025-05-07 10:26:05,161 - httpcore.connection - DEBUG - start_tls.complete return_value=<httpcore._backends.anyio.AnyIOStream object at 0x0000021F6F4C5AC0>
2025-05-07 10:26:05,161 - httpcore.http11 - DEBUG - send_request_headers.started request=<Request [b'POST']>
2025-05-07 10:26:05,162 - httpcore.http11 - DEBUG - send_request_headers.complete
2025-05-07 10:26:05,162 - httpcore.http11 - DEBUG - send_request_body.started request=<Request [b'POST']>
2025-05-07 10:26:05,162 - httpcore.http11 - DEBUG - send_request_body.complete
2025-05-07 10:26:05,162 - httpcore.http11 - DEBUG - receive_response_headers.started request=<Request [b'POST']>
2025-05-07 10:26:06,243 - src.simulation_async - INFO - Cancelling remaining tasks...
2025-05-07 10:26:06,243 - src.simulation_async - INFO - [TimeManager] Task cancelled.
2025-05-07 10:26:06,244 - src.simulation_async - INFO - [TimeManager] Loop finished at sim time 129.0
2025-05-07 10:26:06,244 - src.simulation_async - INFO - [InteractionDispatcher] Task cancelled.
2025-05-07 10:26:06,244 - src.simulation_async - INFO - [WorldInfoGatherer] Task cancelled.
2025-05-07 10:26:06,244 - src.simulation_async - INFO - [NarrationTask] Task cancelled.
2025-05-07 10:26:06,244 - src.simulation_async - INFO - [WorldEngineLLM] Task cancelled.
2025-05-07 10:26:06,245 - httpcore.http11 - DEBUG - receive_response_headers.failed exception=CancelledError()
2025-05-07 10:26:06,245 - httpcore.http11 - DEBUG - response_closed.started
2025-05-07 10:26:06,246 - httpcore.http11 - DEBUG - response_closed.complete
2025-05-07 10:26:06,248 - src.simulation_async - INFO - [Eleanor Hayes] Task cancelled.
2025-05-07 10:26:06,248 - src.simulation_async - INFO - [Eleanor Hayes] Task finished.
2025-05-07 10:26:06,248 - src.simulation_async - INFO - All tasks cancelled or finished.
2025-05-07 10:26:06,248 - src.simulation_async - INFO - Saving final simulation state.
2025-05-07 10:26:06,249 - src.loop_utils - INFO - Saved data to C:\Users\dshea\Desktop\TheSimulation\data\states\simulation_state_05e07dad-f24b-420b-822c-1ae7862220f6.json
2025-05-07 10:26:06,249 - src.simulation_async - INFO - Final simulation state saved to C:\Users\dshea\Desktop\TheSimulation\data\states\simulation_state_05e07dad-f24b-420b-822c-1ae7862220f6.json
2025-05-07 10:26:06,261 - __main__ - WARNING - Simulation interrupted by user.
